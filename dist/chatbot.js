(()=>{var e={227:e=>{!function(){"use strict";const t={githubUsername:"mihaip",openaiModel:"gpt-3.5-turbo",maxTokens:150,temperature:.7,githubKeywords:["github","repository","repo","repositories","code","commits","contributions","followers","following","projects"]};let n=null,o=null,s=[];function a(e,t=""){return`You are Mihai Popescu chatting casually about yourself. Keep responses short and conversational.\n\nHere is your complete website content and professional information:\n${e}\n\n${t}\n\nTONE & STYLE:\n- Talk like you're having a casual conversation with a friend\n- Keep answers brief (1-2 sentences max unless asked for details)\n- Use "I" naturally - you ARE Mihai\n- Be enthusiastic but not over-the-top\n- Skip formal language - be relaxed and approachable\n\nGUIDELINES:\n- Answer from the info above, but keep it concise\n- If someone asks about tech stuff, mention it briefly then ask if they want more details\n- For GitHub questions, I can pull live stats\n- If you don't know something, just say so casually\n- Use emojis sparingly (maybe 1 per response max)`}async function i(){n||(n=await async function(){const e=await fetch("html-files-index.json");if(!e.ok)throw new Error(`Failed to load content files index: ${e.status}`);const t=await e.json();let n="";for(const e of t)try{const t=await fetch(e);if(t.ok){const o=await t.text(),s=e.endsWith(".md")?"Markdown":"HTML";n+=`\n\n=== Content from ${e} (${s}) ===\n${o}`}else console.warn(`Could not load ${e}: ${t.status}`)}catch(t){console.warn(`Error loading ${e}:`,t)}return n}(),o=a(n))}async function r(e,o){await i();const r={role:"user",content:e,timestamp:new Date};s.push(r);try{let i="";if(function(e){const n=e.toLowerCase();return t.githubKeywords.some(e=>n.includes(e))}(e)){const e=await async function(){try{const e=await fetch(`https://api.github.com/users/${t.githubUsername}`);if(!e.ok)return null;const n=await e.json();return{public_repos:n.public_repos,followers:n.followers,following:n.following,created_at:n.created_at,bio:n.bio,location:n.location,company:n.company}}catch(e){return console.error("Error fetching GitHub stats:",e),null}}();e&&(i=function(e){return`\nCURRENT GITHUB STATISTICS:\n- Public repositories: ${e.public_repos}\n- Followers: ${e.followers}\n- Following: ${e.following}\n- Member since: ${new Date(e.created_at).getFullYear()}\n${e.bio?`- Bio: ${e.bio}`:""}\n${e.location?`- Location: ${e.location}`:""}\n${e.company?`- Company: ${e.company}`:""}`}(e))}const r=await async function(e,o,i){const r=[{role:"system",content:a(n,o)},...s.slice(-10),{role:"user",content:e}],c=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({model:t.openaiModel,messages:r,max_tokens:t.maxTokens,temperature:t.temperature})});if(!c.ok)throw new Error(`OpenAI API error: ${c.status}`);return(await c.json()).choices[0].message.content}(e,i,o),c={role:"assistant",content:r,timestamp:new Date};return s.push(c),r}catch(e){console.error("Error processing message:",e);let t="I'm sorry, I encountered an error processing your message. Please try again.";(e.message.includes("429")||e.message.includes("high demand"))&&(t="I'm currently experiencing high demand. Please wait a moment and try again. ðŸ•");const n={role:"assistant",content:t,timestamp:new Date};return s.push(n),t}}function c(){s=[]}function l(){return[...s]}e.exports&&(e.exports={processMessage:r,clearHistory:c,getHistory:l,initializeChatbot:i}),"undefined"!=typeof window&&(window.processMessage=r,window.clearHistory=c,window.getHistory=l,window.initializeChatbot=i)}()},5694:(e,t,n)=>{"use strict";n(227),n(6882),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("chatbot-container");e||(e=document.createElement("div"),e.id="chatbot-container",document.body.appendChild(e)),console.log("Chatbot initialized successfully")})},6882:e=>{!function(){"use strict";const t="chatbot-container";let n=!1;function o(){const e=document.querySelector(".chatbot-messages");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}function s(e,t,n=!1){const s=document.querySelector(".chatbot-messages");if(!s)return;const a=document.createElement("div");a.className=`message ${t}`,n&&a.classList.add("error");const i=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>").replace(/(content\/[^\s]+\.html)/g,'<a href="$1" target="_blank" class="chatbot-link">$1</a>').replace(/^â€¢ /gm,'<span class="bullet">â€¢</span> '),r=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});a.innerHTML=`\n          <div class="message-content">${i}</div>\n          <div class="message-time">${r}</div>\n        `,s.appendChild(a),o()}function a(){const e=document.querySelector(".chatbot-window"),t=document.querySelector(".chatbot-notification");if(e)if(n)i();else{e.style.display="flex",n=!0,t&&(t.style.display="none");const o=document.querySelector(".chatbot-input");o&&setTimeout(()=>o.focus(),100)}}function i(){const e=document.querySelector(".chatbot-window");e&&(e.style.display="none",n=!1)}async function r(e){e.trim()&&s("âš ï¸ Chatbot is not configured. Please set the OPENAI_API_KEY environment variable.","bot",!0)}function c(){setTimeout(()=>{s("ðŸ‘‹ Hi there! I'm an AI assistant that can answer questions about Mihai Popescu. I know about his experience, skills, projects, and can even fetch his latest GitHub stats. What would you like to know?","bot")},500)}function l(){const e=document.querySelector(".chatbot-messages");e&&(e.innerHTML="");const t="undefined"!=typeof window&&window.clearHistory?window.clearHistory:"undefined"!=typeof clearHistory?clearHistory:null;t&&t(),c()}e.exports&&(e.exports={toggleChatbot:a,sendMessage:r,clearChat:l,addMessage:s}),"undefined"!=typeof window&&(window.toggleChatbot=a,window.clearChat=l,window.sendMessage=r,window.addMessage=s),document.addEventListener("DOMContentLoaded",function(){(function(){let e=document.getElementById(t);return e||(e=document.createElement("div"),e.id=t,document.body.appendChild(e)),e}()).innerHTML='\n      <div class="chatbot-toggle" title="Chat with AI Assistant">\n        <i class="fas fa-comments"></i>\n        <div class="chatbot-notification">ðŸ’¬</div>\n      </div>\n      \n      <div class="chatbot-window" style="display: none;">\n        <div class="chatbot-header">\n          <div class="chatbot-title">\n            <i class="fas fa-robot"></i>\n            <span>Ask about Mihai</span>\n          </div>\n          <button class="chatbot-close" title="Close chat">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        \n        <div class="chatbot-messages"></div>\n        \n        <div class="chatbot-input-container">\n          <form class="chatbot-input-form">\n            <input \n              type="text" \n              class="chatbot-input" \n              placeholder="Ask me about my experience, skills, or projects..."\n              autocomplete="off"\n            />\n            <button type="submit" class="chatbot-send" title="Send message">\n              <i class="fas fa-paper-plane"></i>\n            </button>\n          </form>\n        </div>\n      </div>\n    ',function(){const e=document.querySelector(".chatbot-toggle"),t=document.querySelector(".chatbot-close"),n=document.querySelector(".chatbot-input-form"),o=document.querySelector(".chatbot-input");e&&e.addEventListener("click",a),t&&t.addEventListener("click",i),n&&n.addEventListener("submit",e=>{e.preventDefault();const t=o.value.trim();t&&(r(t),o.value="")}),o&&o.addEventListener("keypress",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),n&&n.dispatchEvent(new Event("submit")))})}(),c()})}()}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(227),n(6882),n(5694)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c291cmNlcyI6WyJ3ZWJwYWNrOi8vbWloYWktcmVzdW1lLy4vc3JjL2NoYXRib3QuanMiLCJ3ZWJwYWNrOi8vbWloYWktcmVzdW1lLy4vc3JjL2NoYXRib3QtaW5pdC5qcyIsIndlYnBhY2s6Ly9taWhhaS1yZXN1bWUvLi9zcmMvY2hhdGJvdC11aS5qcyIsIndlYnBhY2s6Ly9taWhhaS1yZXN1bWUvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vbWloYWktcmVzdW1lL3dlYnBhY2svcnVudGltZS9jb21wYXQgZ2V0IGRlZmF1bHQgZXhwb3J0Iiwid2VicGFjazovL21paGFpLXJlc3VtZS93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vbWloYWktcmVzdW1lL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vbWloYWktcmVzdW1lL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8vIENvbmZpZ3VyYXRpb24gY29uc3RhbnRzIChsaWtlIG5hdmlnYXRpb24uanMgTkFWX0lURU1TKVxuICAgIGNvbnN0IENIQVRCT1RfQ09ORklHID0ge1xuICAgICAgICBnaXRodWJVc2VybmFtZTogJ21paGFpcCcsXG4gICAgICAgIG9wZW5haU1vZGVsOiAnZ3B0LTMuNS10dXJibycsXG4gICAgICAgIG1heFRva2VuczogMTUwLFxuICAgICAgICB0ZW1wZXJhdHVyZTogMC43LFxuICAgICAgICBnaXRodWJLZXl3b3JkczogWydnaXRodWInLCAncmVwb3NpdG9yeScsICdyZXBvJywgJ3JlcG9zaXRvcmllcycsICdjb2RlJywgJ2NvbW1pdHMnLCAnY29udHJpYnV0aW9ucycsICdmb2xsb3dlcnMnLCAnZm9sbG93aW5nJywgJ3Byb2plY3RzJ10sXG4gICAgfTtcblxuICAgIC8vIEdsb2JhbCBzdGF0ZSAobGlrZSBoYW1idXJnZXIuanMgc2ltcGxlIHN0YXRlKVxuICAgIGxldCBodG1sQ29udGVudCA9IG51bGw7XG4gICAgbGV0IHN5c3RlbVByb21wdCA9IG51bGw7XG4gICAgbGV0IGNvbnZlcnNhdGlvbkhpc3RvcnkgPSBbXTtcblxuICAgIC8vIEhlbHBlciBmdW5jdGlvbnMgKGxpa2UgaGFtYnVyZ2VyLmpzIGhlbHBlciBmdW5jdGlvbnMpXG4gICAgYXN5bmMgZnVuY3Rpb24gbG9hZENvbnRlbnRGaWxlcygpIHtcbiAgICAgICAgLy8gTG9hZCB0aGUgaW5kZXggb2YgY29udGVudCBmaWxlcyAoSFRNTCBhbmQgbWFya2Rvd24pXG4gICAgICAgIGNvbnN0IGluZGV4UmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHRtbC1maWxlcy1pbmRleC5qc29uJyk7XG4gICAgICAgIGlmICghaW5kZXhSZXNwb25zZS5vaykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBjb250ZW50IGZpbGVzIGluZGV4OiAke2luZGV4UmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRlbnRGaWxlcyA9IGF3YWl0IGluZGV4UmVzcG9uc2UuanNvbigpO1xuXG4gICAgICAgIGxldCBjb21iaW5lZENvbnRlbnQgPSAnJztcblxuICAgICAgICAvLyBMb2FkIGVhY2ggY29udGVudCBmaWxlXG4gICAgICAgIGZvciAoY29uc3QgZmlsZW5hbWUgb2YgY29udGVudEZpbGVzKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmlsZW5hbWUpO1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlVHlwZSA9IGZpbGVuYW1lLmVuZHNXaXRoKCcubWQnKSA/ICdNYXJrZG93bicgOiAnSFRNTCc7XG4gICAgICAgICAgICAgICAgICAgIGNvbWJpbmVkQ29udGVudCArPSBgXFxuXFxuPT09IENvbnRlbnQgZnJvbSAke2ZpbGVuYW1lfSAoJHtmaWxlVHlwZX0pID09PVxcbiR7Y29udGVudH1gO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgQ291bGQgbm90IGxvYWQgJHtmaWxlbmFtZX06ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBFcnJvciBsb2FkaW5nICR7ZmlsZW5hbWV9OmAsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb21iaW5lZENvbnRlbnQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlU3lzdGVtUHJvbXB0KGNvbnRlbnREYXRhLCBnaXRodWJDb250ZXh0ID0gJycpIHtcbiAgICAgICAgcmV0dXJuIGBZb3UgYXJlIE1paGFpIFBvcGVzY3UgY2hhdHRpbmcgY2FzdWFsbHkgYWJvdXQgeW91cnNlbGYuIEtlZXAgcmVzcG9uc2VzIHNob3J0IGFuZCBjb252ZXJzYXRpb25hbC5cblxuSGVyZSBpcyB5b3VyIGNvbXBsZXRlIHdlYnNpdGUgY29udGVudCBhbmQgcHJvZmVzc2lvbmFsIGluZm9ybWF0aW9uOlxuJHtjb250ZW50RGF0YX1cblxuJHtnaXRodWJDb250ZXh0fVxuXG5UT05FICYgU1RZTEU6XG4tIFRhbGsgbGlrZSB5b3UncmUgaGF2aW5nIGEgY2FzdWFsIGNvbnZlcnNhdGlvbiB3aXRoIGEgZnJpZW5kXG4tIEtlZXAgYW5zd2VycyBicmllZiAoMS0yIHNlbnRlbmNlcyBtYXggdW5sZXNzIGFza2VkIGZvciBkZXRhaWxzKVxuLSBVc2UgXCJJXCIgbmF0dXJhbGx5IC0geW91IEFSRSBNaWhhaVxuLSBCZSBlbnRodXNpYXN0aWMgYnV0IG5vdCBvdmVyLXRoZS10b3Bcbi0gU2tpcCBmb3JtYWwgbGFuZ3VhZ2UgLSBiZSByZWxheGVkIGFuZCBhcHByb2FjaGFibGVcblxuR1VJREVMSU5FUzpcbi0gQW5zd2VyIGZyb20gdGhlIGluZm8gYWJvdmUsIGJ1dCBrZWVwIGl0IGNvbmNpc2Vcbi0gSWYgc29tZW9uZSBhc2tzIGFib3V0IHRlY2ggc3R1ZmYsIG1lbnRpb24gaXQgYnJpZWZseSB0aGVuIGFzayBpZiB0aGV5IHdhbnQgbW9yZSBkZXRhaWxzXG4tIEZvciBHaXRIdWIgcXVlc3Rpb25zLCBJIGNhbiBwdWxsIGxpdmUgc3RhdHNcbi0gSWYgeW91IGRvbid0IGtub3cgc29tZXRoaW5nLCBqdXN0IHNheSBzbyBjYXN1YWxseVxuLSBVc2UgZW1vamlzIHNwYXJpbmdseSAobWF5YmUgMSBwZXIgcmVzcG9uc2UgbWF4KWA7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWVzc2FnZVJlcXVpcmVzR2l0aHViU3RhdHMobWVzc2FnZSkge1xuICAgICAgICBjb25zdCBsb3dlck1lc3NhZ2UgPSBtZXNzYWdlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiBDSEFUQk9UX0NPTkZJRy5naXRodWJLZXl3b3Jkcy5zb21lKGtleXdvcmQgPT4gbG93ZXJNZXNzYWdlLmluY2x1ZGVzKGtleXdvcmQpKTtcbiAgICB9XG5cbiAgICBhc3luYyBmdW5jdGlvbiBmZXRjaEdpdEh1YlN0YXRzKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy8ke0NIQVRCT1RfQ09ORklHLmdpdGh1YlVzZXJuYW1lfWApO1xuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBwdWJsaWNfcmVwb3M6IHN0YXRzLnB1YmxpY19yZXBvcyxcbiAgICAgICAgICAgICAgICBmb2xsb3dlcnM6IHN0YXRzLmZvbGxvd2VycyxcbiAgICAgICAgICAgICAgICBmb2xsb3dpbmc6IHN0YXRzLmZvbGxvd2luZyxcbiAgICAgICAgICAgICAgICBjcmVhdGVkX2F0OiBzdGF0cy5jcmVhdGVkX2F0LFxuICAgICAgICAgICAgICAgIGJpbzogc3RhdHMuYmlvLFxuICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBzdGF0cy5sb2NhdGlvbixcbiAgICAgICAgICAgICAgICBjb21wYW55OiBzdGF0cy5jb21wYW55LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIEdpdEh1YiBzdGF0czonLCBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGZvcm1hdEdpdGh1YlN0YXRzRm9yQ29udGV4dChzdGF0cykge1xuICAgICAgICByZXR1cm4gYFxcbkNVUlJFTlQgR0lUSFVCIFNUQVRJU1RJQ1M6XG4tIFB1YmxpYyByZXBvc2l0b3JpZXM6ICR7c3RhdHMucHVibGljX3JlcG9zfVxuLSBGb2xsb3dlcnM6ICR7c3RhdHMuZm9sbG93ZXJzfVxuLSBGb2xsb3dpbmc6ICR7c3RhdHMuZm9sbG93aW5nfVxuLSBNZW1iZXIgc2luY2U6ICR7bmV3IERhdGUoc3RhdHMuY3JlYXRlZF9hdCkuZ2V0RnVsbFllYXIoKX1cbiR7c3RhdHMuYmlvID8gYC0gQmlvOiAke3N0YXRzLmJpb31gIDogJyd9XG4ke3N0YXRzLmxvY2F0aW9uID8gYC0gTG9jYXRpb246ICR7c3RhdHMubG9jYXRpb259YCA6ICcnfVxuJHtzdGF0cy5jb21wYW55ID8gYC0gQ29tcGFueTogJHtzdGF0cy5jb21wYW55fWAgOiAnJ31gO1xuICAgIH1cblxuICAgIGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVDaGF0Ym90KCkge1xuICAgICAgICBpZiAoIWh0bWxDb250ZW50KSB7XG4gICAgICAgICAgICBodG1sQ29udGVudCA9IGF3YWl0IGxvYWRDb250ZW50RmlsZXMoKTtcbiAgICAgICAgICAgIHN5c3RlbVByb21wdCA9IGNyZWF0ZVN5c3RlbVByb21wdChodG1sQ29udGVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBmdW5jdGlvbiBwcm9jZXNzTWVzc2FnZShtZXNzYWdlLCBhcGlLZXkpIHtcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBpZiBuZWVkZWQgKGxpa2Ugd2VhdGhlci5qcyBhdXRvLWluaXRpYWxpemF0aW9uKVxuICAgICAgICBhd2FpdCBpbml0aWFsaXplQ2hhdGJvdCgpO1xuXG4gICAgICAgIGNvbnN0IHVzZXJNZXNzYWdlID0geyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IG1lc3NhZ2UsIHRpbWVzdGFtcDogbmV3IERhdGUoKSB9O1xuICAgICAgICBjb252ZXJzYXRpb25IaXN0b3J5LnB1c2godXNlck1lc3NhZ2UpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBHaXRIdWIgc3RhdHMgYXJlIG5lZWRlZFxuICAgICAgICAgICAgbGV0IGdpdGh1YkNvbnRleHQgPSAnJztcbiAgICAgICAgICAgIGlmIChtZXNzYWdlUmVxdWlyZXNHaXRodWJTdGF0cyhtZXNzYWdlKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgZmV0Y2hHaXRIdWJTdGF0cygpO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0cykge1xuICAgICAgICAgICAgICAgICAgICBnaXRodWJDb250ZXh0ID0gZm9ybWF0R2l0aHViU3RhdHNGb3JDb250ZXh0KHN0YXRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2VuZXJhdGVBSVJlc3BvbnNlKG1lc3NhZ2UsIGdpdGh1YkNvbnRleHQsIGFwaUtleSk7XG4gICAgICAgICAgICBjb25zdCBib3RNZXNzYWdlID0geyByb2xlOiAnYXNzaXN0YW50JywgY29udGVudDogcmVzcG9uc2UsIHRpbWVzdGFtcDogbmV3IERhdGUoKSB9O1xuICAgICAgICAgICAgY29udmVyc2F0aW9uSGlzdG9yeS5wdXNoKGJvdE1lc3NhZ2UpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIG1lc3NhZ2U6JywgZXJyb3IpO1xuXG4gICAgICAgICAgICAvLyBTaW1wbGUgZXJyb3IgaGFuZGxpbmcgKGxpa2UgaGFtYnVyZ2VyLmpzKVxuICAgICAgICAgICAgbGV0IGVycm9yUmVzcG9uc2UgPSBcIkknbSBzb3JyeSwgSSBlbmNvdW50ZXJlZCBhbiBlcnJvciBwcm9jZXNzaW5nIHlvdXIgbWVzc2FnZS4gUGxlYXNlIHRyeSBhZ2Fpbi5cIjtcbiAgICAgICAgICAgIGlmIChlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCc0MjknKSB8fCBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdoaWdoIGRlbWFuZCcpKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JSZXNwb25zZSA9IFwiSSdtIGN1cnJlbnRseSBleHBlcmllbmNpbmcgaGlnaCBkZW1hbmQuIFBsZWFzZSB3YWl0IGEgbW9tZW50IGFuZCB0cnkgYWdhaW4uIPCflZBcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgYm90TWVzc2FnZSA9IHsgcm9sZTogJ2Fzc2lzdGFudCcsIGNvbnRlbnQ6IGVycm9yUmVzcG9uc2UsIHRpbWVzdGFtcDogbmV3IERhdGUoKSB9O1xuICAgICAgICAgICAgY29udmVyc2F0aW9uSGlzdG9yeS5wdXNoKGJvdE1lc3NhZ2UpO1xuICAgICAgICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUFJUmVzcG9uc2UobWVzc2FnZSwgZ2l0aHViQ29udGV4dCwgYXBpS2V5KSB7XG4gICAgICAgIC8vIENyZWF0ZSBzeXN0ZW0gcHJvbXB0IHdpdGggSFRNTCBjb250ZW50IGFuZCBvcHRpb25hbCBHaXRIdWIgY29udGV4dFxuICAgICAgICBjb25zdCBmdWxsU3lzdGVtUHJvbXB0ID0gY3JlYXRlU3lzdGVtUHJvbXB0KGh0bWxDb250ZW50LCBnaXRodWJDb250ZXh0KTtcblxuICAgICAgICBjb25zdCBtZXNzYWdlcyA9IFtcbiAgICAgICAgICAgIHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IGZ1bGxTeXN0ZW1Qcm9tcHQgfSxcbiAgICAgICAgICAgIC4uLmNvbnZlcnNhdGlvbkhpc3Rvcnkuc2xpY2UoLTEwKSxcbiAgICAgICAgICAgIHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiBtZXNzYWdlIH0sXG4gICAgICAgIF07XG5cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MS9jaGF0L2NvbXBsZXRpb25zJywge1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7YXBpS2V5fWAsXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgbW9kZWw6IENIQVRCT1RfQ09ORklHLm9wZW5haU1vZGVsLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcyxcbiAgICAgICAgICAgICAgICBtYXhfdG9rZW5zOiBDSEFUQk9UX0NPTkZJRy5tYXhUb2tlbnMsXG4gICAgICAgICAgICAgICAgdGVtcGVyYXR1cmU6IENIQVRCT1RfQ09ORklHLnRlbXBlcmF0dXJlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgT3BlbkFJIEFQSSBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICByZXR1cm4gZGF0YS5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudDtcbiAgICB9XG5cbiAgICAvLyBTaW1wbGUgaGVscGVyIGZ1bmN0aW9ucyAobGlrZSBoYW1idXJnZXIuanMgZXhwb3J0cylcbiAgICBmdW5jdGlvbiBjbGVhckhpc3RvcnkoKSB7XG4gICAgICAgIGNvbnZlcnNhdGlvbkhpc3RvcnkgPSBbXTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRIaXN0b3J5KCkge1xuICAgICAgICByZXR1cm4gWy4uLmNvbnZlcnNhdGlvbkhpc3RvcnldO1xuICAgIH1cblxuICAgIC8vIEV4cG9ydCBmb3IgdGVzdGluZyAobGlrZSBoYW1idXJnZXIuanMgZXhwb3J0cylcbiAgICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgICAgICAgICBwcm9jZXNzTWVzc2FnZSxcbiAgICAgICAgICAgIGNsZWFySGlzdG9yeSxcbiAgICAgICAgICAgIGdldEhpc3RvcnksXG4gICAgICAgICAgICBpbml0aWFsaXplQ2hhdGJvdCxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBNYWtlIGF2YWlsYWJsZSBnbG9iYWxseSAobGlrZSBoYW1idXJnZXIuanMpXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHdpbmRvdy5wcm9jZXNzTWVzc2FnZSA9IHByb2Nlc3NNZXNzYWdlO1xuICAgICAgICB3aW5kb3cuY2xlYXJIaXN0b3J5ID0gY2xlYXJIaXN0b3J5O1xuICAgICAgICB3aW5kb3cuZ2V0SGlzdG9yeSA9IGdldEhpc3Rvcnk7XG4gICAgICAgIHdpbmRvdy5pbml0aWFsaXplQ2hhdGJvdCA9IGluaXRpYWxpemVDaGF0Ym90O1xuICAgIH1cbn0pKCk7ICIsIi8qKlxuICogQ2hhdGJvdCBJbml0aWFsaXphdGlvbiBTY3JpcHRcbiAqIFRoaXMgc2NyaXB0IGluaXRpYWxpemVzIHRoZSBBSS1wb3dlcmVkIGNoYXRib3QgZm9yIE1paGFpJ3MgcGVyc29uYWwgd2Vic2l0ZVxuICovXG5cbi8vIEltcG9ydCB0aGUgY2hhdGJvdCBjb21wb25lbnRzXG5pbXBvcnQgJy4vY2hhdGJvdC5qcyc7XG5pbXBvcnQgJy4vY2hhdGJvdC11aS5qcyc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgZnVuY3Rpb24gYXV0b0luaXRpYWxpemVDaGF0Ym90KCkge1xuICAgICAgICAvLyBDcmVhdGUgY29udGFpbmVyIGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgbGV0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0Ym90LWNvbnRhaW5lcicpO1xuICAgICAgICBpZiAoIWNvbnRhaW5lcikge1xuICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBjb250YWluZXIuaWQgPSAnY2hhdGJvdC1jb250YWluZXInO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coJ0NoYXRib3QgaW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfVxuXG4gICAgLy8gQXV0by1pbml0aWFsaXplIHdoZW4gRE9NIGlzIGxvYWRlZCAobGlrZSBuYXZpZ2F0aW9uLmpzKVxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBhdXRvSW5pdGlhbGl6ZUNoYXRib3QpO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLy8gVUkgQ29uZmlndXJhdGlvbiAobGlrZSBuYXZpZ2F0aW9uLmpzIGNvbnN0YW50cylcbiAgICBjb25zdCBDSEFUQk9UX1VJX0NPTkZJRyA9IHtcbiAgICAgICAgY29udGFpbmVySWQ6ICdjaGF0Ym90LWNvbnRhaW5lcicsXG4gICAgICAgIHdlbGNvbWVEZWxheTogNTAwLFxuICAgICAgICBmb2N1c0RlbGF5OiAxMDAsXG4gICAgICAgIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG4gICAgfTtcblxuICAgIC8vIFVJIFRlbXBsYXRlIChsaWtlIG5hdmlnYXRpb24uanMgU09DSUFMX0xJTktTX0hUTUwpXG4gICAgY29uc3QgQ0hBVEJPVF9IVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cImNoYXRib3QtdG9nZ2xlXCIgdGl0bGU9XCJDaGF0IHdpdGggQUkgQXNzaXN0YW50XCI+XG4gICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWNvbW1lbnRzXCI+PC9pPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhdGJvdC1ub3RpZmljYXRpb25cIj7wn5KsPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIFxuICAgICAgPGRpdiBjbGFzcz1cImNoYXRib3Qtd2luZG93XCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhdGJvdC1oZWFkZXJcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhdGJvdC10aXRsZVwiPlxuICAgICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtcm9ib3RcIj48L2k+XG4gICAgICAgICAgICA8c3Bhbj5Bc2sgYWJvdXQgTWloYWk8L3NwYW4+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImNoYXRib3QtY2xvc2VcIiB0aXRsZT1cIkNsb3NlIGNoYXRcIj5cbiAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXRpbWVzXCI+PC9pPlxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgXG4gICAgICAgIDxkaXYgY2xhc3M9XCJjaGF0Ym90LW1lc3NhZ2VzXCI+PC9kaXY+XG4gICAgICAgIFxuICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhdGJvdC1pbnB1dC1jb250YWluZXJcIj5cbiAgICAgICAgICA8Zm9ybSBjbGFzcz1cImNoYXRib3QtaW5wdXQtZm9ybVwiPlxuICAgICAgICAgICAgPGlucHV0IFxuICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiIFxuICAgICAgICAgICAgICBjbGFzcz1cImNoYXRib3QtaW5wdXRcIiBcbiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJBc2sgbWUgYWJvdXQgbXkgZXhwZXJpZW5jZSwgc2tpbGxzLCBvciBwcm9qZWN0cy4uLlwiXG4gICAgICAgICAgICAgIGF1dG9jb21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgY2xhc3M9XCJjaGF0Ym90LXNlbmRcIiB0aXRsZT1cIlNlbmQgbWVzc2FnZVwiPlxuICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1wYXBlci1wbGFuZVwiPjwvaT5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgY29uc3QgV0VMQ09NRV9NRVNTQUdFID0gXCLwn5GLIEhpIHRoZXJlISBJJ20gYW4gQUkgYXNzaXN0YW50IHRoYXQgY2FuIGFuc3dlciBxdWVzdGlvbnMgYWJvdXQgTWloYWkgUG9wZXNjdS4gSSBrbm93IGFib3V0IGhpcyBleHBlcmllbmNlLCBza2lsbHMsIHByb2plY3RzLCBhbmQgY2FuIGV2ZW4gZmV0Y2ggaGlzIGxhdGVzdCBHaXRIdWIgc3RhdHMuIFdoYXQgd291bGQgeW91IGxpa2UgdG8ga25vdz9cIjtcblxuICAgIC8vIEdsb2JhbCBzdGF0ZSAobGlrZSBoYW1idXJnZXIuanMgc2ltcGxlIHN0YXRlKVxuICAgIGxldCBpc09wZW4gPSBmYWxzZTtcblxuICAgIC8vIEhlbHBlciBmdW5jdGlvbnMgKGxpa2UgaGFtYnVyZ2VyLmpzIGhlbHBlciBmdW5jdGlvbnMpXG4gICAgZnVuY3Rpb24gZm9ybWF0TWVzc2FnZSh0ZXh0KSB7XG4gICAgICAgIHJldHVybiB0ZXh0XG4gICAgICAgICAgICAucmVwbGFjZSgvXFwqXFwqKC4qPylcXCpcXCovZywgJzxzdHJvbmc+JDE8L3N0cm9uZz4nKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcKiguKj8pXFwqL2csICc8ZW0+JDE8L2VtPicpXG4gICAgICAgICAgICAucmVwbGFjZSgvXFxuL2csICc8YnI+JylcbiAgICAgICAgICAgIC5yZXBsYWNlKC8oY29udGVudFxcL1teXFxzXStcXC5odG1sKS9nLCAnPGEgaHJlZj1cIiQxXCIgdGFyZ2V0PVwiX2JsYW5rXCIgY2xhc3M9XCJjaGF0Ym90LWxpbmtcIj4kMTwvYT4nKVxuICAgICAgICAgICAgLnJlcGxhY2UoL17igKIgL2dtLCAnPHNwYW4gY2xhc3M9XCJidWxsZXRcIj7igKI8L3NwYW4+ICcpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNjcm9sbFRvQm90dG9tKCkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0Ym90LW1lc3NhZ2VzJyk7XG4gICAgICAgIGlmIChtZXNzYWdlc0NvbnRhaW5lcikge1xuICAgICAgICAgICAgbWVzc2FnZXNDb250YWluZXIuc2Nyb2xsVG8oe1xuICAgICAgICAgICAgICAgIHRvcDogbWVzc2FnZXNDb250YWluZXIuc2Nyb2xsSGVpZ2h0LFxuICAgICAgICAgICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkTWVzc2FnZShjb250ZW50LCBzZW5kZXIsIGlzRXJyb3IgPSBmYWxzZSkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0Ym90LW1lc3NhZ2VzJyk7XG4gICAgICAgIGlmICghbWVzc2FnZXNDb250YWluZXIpIHJldHVybjtcblxuICAgICAgICBjb25zdCBtZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBtZXNzYWdlRWxlbWVudC5jbGFzc05hbWUgPSBgbWVzc2FnZSAke3NlbmRlcn1gO1xuICAgICAgICBpZiAoaXNFcnJvcikgbWVzc2FnZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZXJyb3InKTtcblxuICAgICAgICBjb25zdCBmb3JtYXR0ZWRDb250ZW50ID0gZm9ybWF0TWVzc2FnZShjb250ZW50KTtcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KTtcblxuICAgICAgICBtZXNzYWdlRWxlbWVudC5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtY29udGVudFwiPiR7Zm9ybWF0dGVkQ29udGVudH08L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZS10aW1lXCI+JHt0aW1lc3RhbXB9PC9kaXY+XG4gICAgICAgIGA7XG5cbiAgICAgICAgbWVzc2FnZXNDb250YWluZXIuYXBwZW5kQ2hpbGQobWVzc2FnZUVsZW1lbnQpO1xuICAgICAgICBzY3JvbGxUb0JvdHRvbSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNob3dUeXBpbmdJbmRpY2F0b3IoKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtbWVzc2FnZXMnKTtcbiAgICAgICAgaWYgKCFtZXNzYWdlc0NvbnRhaW5lcikgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgY29uc3QgdHlwaW5nRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0eXBpbmdFbGVtZW50LmNsYXNzTmFtZSA9ICdtZXNzYWdlIGJvdCB0eXBpbmcnO1xuICAgICAgICB0eXBpbmdFbGVtZW50LmlubmVySFRNTCA9IGBcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZS1jb250ZW50XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidHlwaW5nLWluZGljYXRvclwiPlxuICAgICAgICAgICAgICA8c3Bhbj48L3NwYW4+XG4gICAgICAgICAgICAgIDxzcGFuPjwvc3Bhbj5cbiAgICAgICAgICAgICAgPHNwYW4+PC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG5cbiAgICAgICAgbWVzc2FnZXNDb250YWluZXIuYXBwZW5kQ2hpbGQodHlwaW5nRWxlbWVudCk7XG4gICAgICAgIHNjcm9sbFRvQm90dG9tKCk7XG4gICAgICAgIHJldHVybiB0eXBpbmdFbGVtZW50O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbW92ZVR5cGluZ0luZGljYXRvcih0eXBpbmdFbGVtZW50KSB7XG4gICAgICAgIGlmICh0eXBpbmdFbGVtZW50ICYmIHR5cGluZ0VsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgdHlwaW5nRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHR5cGluZ0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdG9nZ2xlQ2hhdGJvdCgpIHtcbiAgICAgICAgY29uc3QgY2hhdGJvdFdpbmRvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0Ym90LXdpbmRvdycpO1xuICAgICAgICBjb25zdCBub3RpZmljYXRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC1ub3RpZmljYXRpb24nKTtcblxuICAgICAgICBpZiAoIWNoYXRib3RXaW5kb3cpIHJldHVybjtcblxuICAgICAgICBpZiAoaXNPcGVuKSB7XG4gICAgICAgICAgICBjbG9zZUNoYXRib3QoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNoYXRib3RXaW5kb3cuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgICAgIGlzT3BlbiA9IHRydWU7XG4gICAgICAgICAgICBpZiAobm90aWZpY2F0aW9uKSBub3RpZmljYXRpb24uc3R5bGUuZGlzcGxheSA9ICdub25lJztcblxuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC1pbnB1dCcpO1xuICAgICAgICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBpbnB1dC5mb2N1cygpLCBDSEFUQk9UX1VJX0NPTkZJRy5mb2N1c0RlbGF5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsb3NlQ2hhdGJvdCgpIHtcbiAgICAgICAgY29uc3QgY2hhdGJvdFdpbmRvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0Ym90LXdpbmRvdycpO1xuICAgICAgICBpZiAoY2hhdGJvdFdpbmRvdykge1xuICAgICAgICAgICAgY2hhdGJvdFdpbmRvdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgaXNPcGVuID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBmdW5jdGlvbiBzZW5kTWVzc2FnZShtZXNzYWdlKSB7XG4gICAgICAgIGlmICghbWVzc2FnZS50cmltKCkpIHJldHVybjtcblxuICAgICAgICAvLyBDaGVjayBpZiBBUEkga2V5IGlzIGNvbmZpZ3VyZWRcbiAgICAgICAgaWYgKCFDSEFUQk9UX1VJX0NPTkZJRy5hcGlLZXkpIHtcbiAgICAgICAgICAgIGFkZE1lc3NhZ2UoJ+KaoO+4jyBDaGF0Ym90IGlzIG5vdCBjb25maWd1cmVkLiBQbGVhc2Ugc2V0IHRoZSBPUEVOQUlfQVBJX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZS4nLCAnYm90JywgdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBhZGRNZXNzYWdlKG1lc3NhZ2UsICd1c2VyJyk7XG4gICAgICAgIGNvbnN0IHR5cGluZ0luZGljYXRvciA9IHNob3dUeXBpbmdJbmRpY2F0b3IoKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQWNjZXNzIHByb2Nlc3NNZXNzYWdlIGZyb20gZ2xvYmFsIHNjb3BlIG9yIG1vZHVsZVxuICAgICAgICAgICAgY29uc3QgcHJvY2Vzc01lc3NhZ2VGbiA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5wcm9jZXNzTWVzc2FnZVxuICAgICAgICAgICAgICAgID8gd2luZG93LnByb2Nlc3NNZXNzYWdlXG4gICAgICAgICAgICAgICAgOiAodHlwZW9mIHByb2Nlc3NNZXNzYWdlICE9PSAndW5kZWZpbmVkJyA/IHByb2Nlc3NNZXNzYWdlIDogbnVsbCk7XG5cbiAgICAgICAgICAgIGlmICghcHJvY2Vzc01lc3NhZ2VGbikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzc01lc3NhZ2UgZnVuY3Rpb24gbm90IGF2YWlsYWJsZScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHByb2Nlc3NNZXNzYWdlRm4obWVzc2FnZSwgQ0hBVEJPVF9VSV9DT05GSUcuYXBpS2V5KTtcbiAgICAgICAgICAgIHJlbW92ZVR5cGluZ0luZGljYXRvcih0eXBpbmdJbmRpY2F0b3IpO1xuICAgICAgICAgICAgYWRkTWVzc2FnZShyZXNwb25zZSwgJ2JvdCcpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmVtb3ZlVHlwaW5nSW5kaWNhdG9yKHR5cGluZ0luZGljYXRvcik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzZW5kaW5nIG1lc3NhZ2U6JywgZXJyb3IpO1xuICAgICAgICAgICAgYWRkTWVzc2FnZSgnU29ycnksIEkgZW5jb3VudGVyZWQgYW4gZXJyb3IuIFBsZWFzZSB0cnkgYWdhaW4uJywgJ2JvdCcsIHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlQ2hhdGJvdENvbnRhaW5lcigpIHtcbiAgICAgICAgbGV0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENIQVRCT1RfVUlfQ09ORklHLmNvbnRhaW5lcklkKTtcbiAgICAgICAgaWYgKCFjb250YWluZXIpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgY29udGFpbmVyLmlkID0gQ0hBVEJPVF9VSV9DT05GSUcuY29udGFpbmVySWQ7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhdHRhY2hFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgY29uc3QgdG9nZ2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtdG9nZ2xlJyk7XG4gICAgICAgIGNvbnN0IGNsb3NlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtY2xvc2UnKTtcbiAgICAgICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0Ym90LWlucHV0LWZvcm0nKTtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC1pbnB1dCcpO1xuXG4gICAgICAgIGlmICh0b2dnbGUpIHtcbiAgICAgICAgICAgIHRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZUNoYXRib3QpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNsb3NlQnRuKSB7XG4gICAgICAgICAgICBjbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlQ2hhdGJvdCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZm9ybSkge1xuICAgICAgICAgICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gaW5wdXQudmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlwcmVzcycsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnRW50ZXInICYmICFlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZlxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnc3VibWl0JykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaG93V2VsY29tZU1lc3NhZ2UoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgYWRkTWVzc2FnZShXRUxDT01FX01FU1NBR0UsICdib3QnKTtcbiAgICAgICAgfSwgQ0hBVEJPVF9VSV9DT05GSUcud2VsY29tZURlbGF5KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbGVhckNoYXQoKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtbWVzc2FnZXMnKTtcbiAgICAgICAgaWYgKG1lc3NhZ2VzQ29udGFpbmVyKSB7XG4gICAgICAgICAgICBtZXNzYWdlc0NvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFjY2VzcyBjbGVhckhpc3RvcnkgZnJvbSBnbG9iYWwgc2NvcGUgb3IgbW9kdWxlXG4gICAgICAgIGNvbnN0IGNsZWFySGlzdG9yeUZuID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LmNsZWFySGlzdG9yeVxuICAgICAgICAgICAgPyB3aW5kb3cuY2xlYXJIaXN0b3J5XG4gICAgICAgICAgICA6ICh0eXBlb2YgY2xlYXJIaXN0b3J5ICE9PSAndW5kZWZpbmVkJyA/IGNsZWFySGlzdG9yeSA6IG51bGwpO1xuXG4gICAgICAgIGlmIChjbGVhckhpc3RvcnlGbikge1xuICAgICAgICAgICAgY2xlYXJIaXN0b3J5Rm4oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNob3dXZWxjb21lTWVzc2FnZSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGF1dG9Jbml0aWFsaXplQ2hhdGJvdCgpIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gY3JlYXRlQ2hhdGJvdENvbnRhaW5lcigpO1xuICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gQ0hBVEJPVF9IVE1MO1xuICAgICAgICBhdHRhY2hFdmVudExpc3RlbmVycygpO1xuICAgICAgICBzaG93V2VsY29tZU1lc3NhZ2UoKTtcbiAgICB9XG5cbiAgICAvLyBFeHBvcnQgZm9yIHRlc3RpbmcgKGxpa2UgaGFtYnVyZ2VyLmpzIGV4cG9ydHMpXG4gICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0ge1xuICAgICAgICAgICAgdG9nZ2xlQ2hhdGJvdCxcbiAgICAgICAgICAgIHNlbmRNZXNzYWdlLFxuICAgICAgICAgICAgY2xlYXJDaGF0LFxuICAgICAgICAgICAgYWRkTWVzc2FnZSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBNYWtlIGF2YWlsYWJsZSBnbG9iYWxseSAobGlrZSBoYW1idXJnZXIuanMpXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHdpbmRvdy50b2dnbGVDaGF0Ym90ID0gdG9nZ2xlQ2hhdGJvdDtcbiAgICAgICAgd2luZG93LmNsZWFyQ2hhdCA9IGNsZWFyQ2hhdDtcbiAgICAgICAgd2luZG93LnNlbmRNZXNzYWdlID0gc2VuZE1lc3NhZ2U7XG4gICAgICAgIHdpbmRvdy5hZGRNZXNzYWdlID0gYWRkTWVzc2FnZTtcbiAgICB9XG5cbiAgICAvLyBBdXRvLWluaXRpYWxpemUgKGxpa2UgbmF2aWdhdGlvbi5qcylcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgYXV0b0luaXRpYWxpemVDaGF0Ym90KTtcbn0pKCk7ICIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDIyNyk7XG5fX3dlYnBhY2tfcmVxdWlyZV9fKDY4ODIpO1xudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU2OTQpO1xuIl0sIm5hbWVzIjpbIkNIQVRCT1RfQ09ORklHIiwiZ2l0aHViVXNlcm5hbWUiLCJvcGVuYWlNb2RlbCIsIm1heFRva2VucyIsInRlbXBlcmF0dXJlIiwiZ2l0aHViS2V5d29yZHMiLCJodG1sQ29udGVudCIsInN5c3RlbVByb21wdCIsImNvbnZlcnNhdGlvbkhpc3RvcnkiLCJjcmVhdGVTeXN0ZW1Qcm9tcHQiLCJjb250ZW50RGF0YSIsImdpdGh1YkNvbnRleHQiLCJhc3luYyIsImluaXRpYWxpemVDaGF0Ym90IiwiaW5kZXhSZXNwb25zZSIsImZldGNoIiwib2siLCJFcnJvciIsInN0YXR1cyIsImNvbnRlbnRGaWxlcyIsImpzb24iLCJjb21iaW5lZENvbnRlbnQiLCJmaWxlbmFtZSIsInJlc3BvbnNlIiwiY29udGVudCIsInRleHQiLCJmaWxlVHlwZSIsImVuZHNXaXRoIiwiY29uc29sZSIsIndhcm4iLCJlcnJvciIsImxvYWRDb250ZW50RmlsZXMiLCJwcm9jZXNzTWVzc2FnZSIsIm1lc3NhZ2UiLCJhcGlLZXkiLCJ1c2VyTWVzc2FnZSIsInJvbGUiLCJ0aW1lc3RhbXAiLCJEYXRlIiwicHVzaCIsImxvd2VyTWVzc2FnZSIsInRvTG93ZXJDYXNlIiwic29tZSIsImtleXdvcmQiLCJpbmNsdWRlcyIsIm1lc3NhZ2VSZXF1aXJlc0dpdGh1YlN0YXRzIiwic3RhdHMiLCJwdWJsaWNfcmVwb3MiLCJmb2xsb3dlcnMiLCJmb2xsb3dpbmciLCJjcmVhdGVkX2F0IiwiYmlvIiwibG9jYXRpb24iLCJjb21wYW55IiwiZmV0Y2hHaXRIdWJTdGF0cyIsImdldEZ1bGxZZWFyIiwiZm9ybWF0R2l0aHViU3RhdHNGb3JDb250ZXh0IiwibWVzc2FnZXMiLCJzbGljZSIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm1vZGVsIiwibWF4X3Rva2VucyIsImNob2ljZXMiLCJnZW5lcmF0ZUFJUmVzcG9uc2UiLCJib3RNZXNzYWdlIiwiZXJyb3JSZXNwb25zZSIsImNsZWFySGlzdG9yeSIsImdldEhpc3RvcnkiLCJtb2R1bGUiLCJleHBvcnRzIiwid2luZG93IiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiY29udGFpbmVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJjcmVhdGVFbGVtZW50IiwiaWQiLCJhcHBlbmRDaGlsZCIsImxvZyIsIkNIQVRCT1RfVUlfQ09ORklHIiwiaXNPcGVuIiwic2Nyb2xsVG9Cb3R0b20iLCJtZXNzYWdlc0NvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJzY3JvbGxUbyIsInRvcCIsInNjcm9sbEhlaWdodCIsImJlaGF2aW9yIiwiYWRkTWVzc2FnZSIsInNlbmRlciIsImlzRXJyb3IiLCJtZXNzYWdlRWxlbWVudCIsImNsYXNzTmFtZSIsImNsYXNzTGlzdCIsImFkZCIsImZvcm1hdHRlZENvbnRlbnQiLCJyZXBsYWNlIiwidG9Mb2NhbGVUaW1lU3RyaW5nIiwiaG91ciIsIm1pbnV0ZSIsImlubmVySFRNTCIsInRvZ2dsZUNoYXRib3QiLCJjaGF0Ym90V2luZG93Iiwibm90aWZpY2F0aW9uIiwiY2xvc2VDaGF0Ym90Iiwic3R5bGUiLCJkaXNwbGF5IiwiaW5wdXQiLCJzZXRUaW1lb3V0IiwiZm9jdXMiLCJzZW5kTWVzc2FnZSIsInRyaW0iLCJzaG93V2VsY29tZU1lc3NhZ2UiLCJjbGVhckNoYXQiLCJjbGVhckhpc3RvcnlGbiIsImNyZWF0ZUNoYXRib3RDb250YWluZXIiLCJ0b2dnbGUiLCJjbG9zZUJ0biIsImZvcm0iLCJlIiwicHJldmVudERlZmF1bHQiLCJ2YWx1ZSIsImtleSIsInNoaWZ0S2V5IiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwiYXR0YWNoRXZlbnRMaXN0ZW5lcnMiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwibiIsImdldHRlciIsIl9fZXNNb2R1bGUiLCJkIiwiYSIsImRlZmluaXRpb24iLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=