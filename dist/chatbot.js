(()=>{var e={227:e=>{!function(){"use strict";const t={githubUsername:"mihaip",openaiModel:"gpt-3.5-turbo",maxTokens:150,temperature:.7,githubKeywords:["github","repository","repo","repositories","code","commits","contributions","followers","following","projects"]};let n=null,o=null,s=[];function a(e,t=""){return`You are Mihai Popescu chatting casually about yourself. Keep responses short and conversational.\n\nHere is your complete website content and professional information:\n${e}\n\n${t}\n\nTONE & STYLE:\n- Talk like you're having a casual conversation with a friend\n- Keep answers brief (1-2 sentences max unless asked for details)\n- Use "I" naturally - you ARE Mihai\n- Be enthusiastic but not over-the-top\n- Skip formal language - be relaxed and approachable\n\nGUIDELINES:\n- Answer from the info above, but keep it concise\n- If someone asks about tech stuff, mention it briefly then ask if they want more details\n- For GitHub questions, I can pull live stats\n- If you don't know something, just say so casually\n- Use emojis sparingly (maybe 1 per response max)`}async function i(){n||(n=await async function(){const e=await fetch("html-files-index.json");if(!e.ok)throw new Error(`Failed to load content files index: ${e.status}`);const t=await e.json();let n="";for(const e of t)try{const t=await fetch(e);if(t.ok){const o=await t.text(),s=e.endsWith(".md")?"Markdown":"HTML";n+=`\n\n=== Content from ${e} (${s}) ===\n${o}`}else console.warn(`Could not load ${e}: ${t.status}`)}catch(t){console.warn(`Error loading ${e}:`,t)}return n}(),o=a(n))}async function r(e,o=null){await i();const r={role:"user",content:e,timestamp:new Date};s.push(r);try{let o="";if(function(e){const n=e.toLowerCase();return t.githubKeywords.some(e=>n.includes(e))}(e)){const e=await async function(){try{const e=await fetch(`https://api.github.com/users/${t.githubUsername}`);if(!e.ok)return null;const n=await e.json();return{public_repos:n.public_repos,followers:n.followers,following:n.following,created_at:n.created_at,bio:n.bio,location:n.location,company:n.company}}catch(e){return console.error("Error fetching GitHub stats:",e),null}}();e&&(o=function(e){return`\nCURRENT GITHUB STATISTICS:\n- Public repositories: ${e.public_repos}\n- Followers: ${e.followers}\n- Following: ${e.following}\n- Member since: ${new Date(e.created_at).getFullYear()}\n${e.bio?`- Bio: ${e.bio}`:""}\n${e.location?`- Location: ${e.location}`:""}\n${e.company?`- Company: ${e.company}`:""}`}(e))}const i=await async function(e,o){const i=[{role:"system",content:a(n,o)},...s.slice(-10),{role:"user",content:e}],r=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:t.openaiModel,messages:i,max_tokens:t.maxTokens,temperature:t.temperature})});if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.error||`Server error: ${r.status}`)}return(await r.json()).choices[0].message.content}(e,o),r={role:"assistant",content:i,timestamp:new Date};return s.push(r),i}catch(e){console.error("Error processing message:",e);let t="I'm sorry, I encountered an error processing your message. Please try again.";(e.message.includes("429")||e.message.includes("high demand"))&&(t="I'm currently experiencing high demand. Please wait a moment and try again. 🕐");const n={role:"assistant",content:t,timestamp:new Date};return s.push(n),t}}function c(){s=[]}function l(){return[...s]}e.exports&&(e.exports={processMessage:r,clearHistory:c,getHistory:l,initializeChatbot:i}),"undefined"!=typeof window&&(window.processMessage=r,window.clearHistory=c,window.getHistory=l,window.initializeChatbot=i)}()},5694:(e,t,n)=>{"use strict";n(227),n(6882),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("chatbot-container");e||(e=document.createElement("div"),e.id="chatbot-container",document.body.appendChild(e)),console.log("Chatbot initialized successfully")})},6882:e=>{!function(){"use strict";const t="chatbot-container";let n=!1;function o(){const e=document.querySelector(".chatbot-messages");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}function s(e,t,n=!1){const s=document.querySelector(".chatbot-messages");if(!s)return;const a=document.createElement("div");a.className=`message ${t}`,n&&a.classList.add("error");const i=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>").replace(/(content\/[^\s]+\.html)/g,'<a href="$1" target="_blank" class="chatbot-link">$1</a>').replace(/^• /gm,'<span class="bullet">•</span> '),r=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});a.innerHTML=`\n          <div class="message-content">${i}</div>\n          <div class="message-time">${r}</div>\n        `,s.appendChild(a),o()}function a(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function i(){const e=document.querySelector(".chatbot-window"),t=document.querySelector(".chatbot-notification");if(e)if(n)r();else{e.style.display="flex",n=!0,t&&(t.style.display="none");const o=document.querySelector(".chatbot-input");o&&setTimeout(()=>o.focus(),100)}}function r(){const e=document.querySelector(".chatbot-window");e&&(e.style.display="none",n=!1)}async function c(e){if(!e.trim())return;s(e,"user");const t=function(){const e=document.querySelector(".chatbot-messages");if(!e)return null;const t=document.createElement("div");return t.className="message bot typing",t.innerHTML='\n          <div class="message-content">\n            <div class="typing-indicator">\n              <span></span>\n              <span></span>\n              <span></span>\n            </div>\n          </div>\n        ',e.appendChild(t),o(),t}();try{const n="undefined"!=typeof window&&window.processMessage?window.processMessage:"undefined"!=typeof processMessage?processMessage:null;if(!n)throw new Error("processMessage function not available");const o=await n(e);a(t),s(o,"bot")}catch(e){a(t),console.error("Error sending message:",e),s("Sorry, I encountered an error. Please try again.","bot",!0)}}function l(){setTimeout(()=>{s("👋 Hi there! I'm an AI assistant that can answer questions about Mihai Popescu. I know about his experience, skills, projects, and can even fetch his latest GitHub stats. What would you like to know?","bot")},500)}function u(){const e=document.querySelector(".chatbot-messages");e&&(e.innerHTML="");const t="undefined"!=typeof window&&window.clearHistory?window.clearHistory:"undefined"!=typeof clearHistory?clearHistory:null;t&&t(),l()}e.exports&&(e.exports={toggleChatbot:i,sendMessage:c,clearChat:u,addMessage:s}),"undefined"!=typeof window&&(window.toggleChatbot=i,window.clearChat=u,window.sendMessage=c,window.addMessage=s),document.addEventListener("DOMContentLoaded",function(){(function(){let e=document.getElementById(t);return e||(e=document.createElement("div"),e.id=t,document.body.appendChild(e)),e}()).innerHTML='\n      <div class="chatbot-toggle" title="Chat with AI Assistant">\n        <i class="fas fa-comments"></i>\n        <div class="chatbot-notification">💬</div>\n      </div>\n      \n      <div class="chatbot-window" style="display: none;">\n        <div class="chatbot-header">\n          <div class="chatbot-title">\n            <i class="fas fa-robot"></i>\n            <span>Ask about Mihai</span>\n          </div>\n          <button class="chatbot-close" title="Close chat">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        \n        <div class="chatbot-messages"></div>\n        \n        <div class="chatbot-input-container">\n          <form class="chatbot-input-form">\n            <input \n              type="text" \n              class="chatbot-input" \n              placeholder="Ask me about my experience, skills, or projects..."\n              autocomplete="off"\n            />\n            <button type="submit" class="chatbot-send" title="Send message">\n              <i class="fas fa-paper-plane"></i>\n            </button>\n          </form>\n        </div>\n      </div>\n    ',function(){const e=document.querySelector(".chatbot-toggle"),t=document.querySelector(".chatbot-close"),n=document.querySelector(".chatbot-input-form"),o=document.querySelector(".chatbot-input");e&&e.addEventListener("click",i),t&&t.addEventListener("click",r),n&&n.addEventListener("submit",e=>{e.preventDefault();const t=o.value.trim();t&&(c(t),o.value="")}),o&&o.addEventListener("keypress",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),n&&n.dispatchEvent(new Event("submit")))})}(),l()})}()}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(227),n(6882),n(5694)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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b0JDLEdBRTVCLElBQUlDLEVBQWVILEVBQXlCRSxHQUM1QyxRQUFxQkUsSUFBakJELEVBQ0gsT0FBT0EsRUFBYXBFLFFBR3JCLElBQUlELEVBQVNrRSxFQUF5QkUsR0FBWSxDQUdqRG5FLFFBQVMsQ0FBQyxHQU9YLE9BSEFzRSxFQUFvQkgsR0FBVXBFLEVBQVFBLEVBQU9DLFFBQVNrRSxHQUcvQ25FLEVBQU9DLE9BQ2YsQ0NyQkFrRSxFQUFvQkssRUFBS3hFLElBQ3hCLElBQUl5RSxFQUFTekUsR0FBVUEsRUFBTzBFLFdBQzdCLElBQU8xRSxFQUFpQixRQUN4QixJQUFNLEVBRVAsT0FEQW1FLEVBQW9CUSxFQUFFRixFQUFRLENBQUVHLEVBQUdILElBQzVCQSxHQ0xSTixFQUFvQlEsRUFBSSxDQUFDMUUsRUFBUzRFLEtBQ2pDLElBQUksSUFBSWhCLEtBQU9nQixFQUNYVixFQUFvQlcsRUFBRUQsRUFBWWhCLEtBQVNNLEVBQW9CVyxFQUFFN0UsRUFBUzRELElBQzVFa0IsT0FBT0MsZUFBZS9FLEVBQVM0RCxFQUFLLENBQUVvQixZQUFZLEVBQU1DLElBQUtMLEVBQVdoQixNQ0ozRU0sRUFBb0JXLEVBQUksQ0FBQ0ssRUFBS0MsSUFBVUwsT0FBT00sVUFBVUMsZUFBZUMsS0FBS0osRUFBS0MsR0NHbEZqQixFQUFvQixLQUNwQkEsRUFBb0IsTUFDTUEsRUFBb0IsSyIsInNvdXJjZXMiOlsid2VicGFjazovL21paGFpLXJlc3VtZS8uL3NyYy9jaGF0Ym90LmpzIiwid2VicGFjazovL21paGFpLXJlc3VtZS8uL3NyYy9jaGF0Ym90LWluaXQuanMiLCJ3ZWJwYWNrOi8vbWloYWktcmVzdW1lLy4vc3JjL2NoYXRib3QtdWkuanMiLCJ3ZWJwYWNrOi8vbWloYWktcmVzdW1lL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL21paGFpLXJlc3VtZS93ZWJwYWNrL3J1bnRpbWUvY29tcGF0IGdldCBkZWZhdWx0IGV4cG9ydCIsIndlYnBhY2s6Ly9taWhhaS1yZXN1bWUvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL21paGFpLXJlc3VtZS93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL21paGFpLXJlc3VtZS93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvLyBDb25maWd1cmF0aW9uIGNvbnN0YW50cyAobGlrZSBuYXZpZ2F0aW9uLmpzIE5BVl9JVEVNUylcbiAgICBjb25zdCBDSEFUQk9UX0NPTkZJRyA9IHtcbiAgICAgICAgZ2l0aHViVXNlcm5hbWU6ICdtaWhhaXAnLFxuICAgICAgICBvcGVuYWlNb2RlbDogJ2dwdC0zLjUtdHVyYm8nLFxuICAgICAgICBtYXhUb2tlbnM6IDE1MCxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgZ2l0aHViS2V5d29yZHM6IFsnZ2l0aHViJywgJ3JlcG9zaXRvcnknLCAncmVwbycsICdyZXBvc2l0b3JpZXMnLCAnY29kZScsICdjb21taXRzJywgJ2NvbnRyaWJ1dGlvbnMnLCAnZm9sbG93ZXJzJywgJ2ZvbGxvd2luZycsICdwcm9qZWN0cyddLFxuICAgIH07XG5cbiAgICAvLyBHbG9iYWwgc3RhdGUgKGxpa2UgaGFtYnVyZ2VyLmpzIHNpbXBsZSBzdGF0ZSlcbiAgICBsZXQgaHRtbENvbnRlbnQgPSBudWxsO1xuICAgIGxldCBzeXN0ZW1Qcm9tcHQgPSBudWxsO1xuICAgIGxldCBjb252ZXJzYXRpb25IaXN0b3J5ID0gW107XG5cbiAgICAvLyBIZWxwZXIgZnVuY3Rpb25zIChsaWtlIGhhbWJ1cmdlci5qcyBoZWxwZXIgZnVuY3Rpb25zKVxuICAgIGFzeW5jIGZ1bmN0aW9uIGxvYWRDb250ZW50RmlsZXMoKSB7XG4gICAgICAgIC8vIExvYWQgdGhlIGluZGV4IG9mIGNvbnRlbnQgZmlsZXMgKEhUTUwgYW5kIG1hcmtkb3duKVxuICAgICAgICBjb25zdCBpbmRleFJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0bWwtZmlsZXMtaW5kZXguanNvbicpO1xuICAgICAgICBpZiAoIWluZGV4UmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgY29udGVudCBmaWxlcyBpbmRleDogJHtpbmRleFJlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250ZW50RmlsZXMgPSBhd2FpdCBpbmRleFJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgICBsZXQgY29tYmluZWRDb250ZW50ID0gJyc7XG5cbiAgICAgICAgLy8gTG9hZCBlYWNoIGNvbnRlbnQgZmlsZVxuICAgICAgICBmb3IgKGNvbnN0IGZpbGVuYW1lIG9mIGNvbnRlbnRGaWxlcykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGVuYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmlsZVR5cGUgPSBmaWxlbmFtZS5lbmRzV2l0aCgnLm1kJykgPyAnTWFya2Rvd24nIDogJ0hUTUwnO1xuICAgICAgICAgICAgICAgICAgICBjb21iaW5lZENvbnRlbnQgKz0gYFxcblxcbj09PSBDb250ZW50IGZyb20gJHtmaWxlbmFtZX0gKCR7ZmlsZVR5cGV9KSA9PT1cXG4ke2NvbnRlbnR9YDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYENvdWxkIG5vdCBsb2FkICR7ZmlsZW5hbWV9OiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgRXJyb3IgbG9hZGluZyAke2ZpbGVuYW1lfTpgLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29tYmluZWRDb250ZW50O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZVN5c3RlbVByb21wdChjb250ZW50RGF0YSwgZ2l0aHViQ29udGV4dCA9ICcnKSB7XG4gICAgICAgIHJldHVybiBgWW91IGFyZSBNaWhhaSBQb3Blc2N1IGNoYXR0aW5nIGNhc3VhbGx5IGFib3V0IHlvdXJzZWxmLiBLZWVwIHJlc3BvbnNlcyBzaG9ydCBhbmQgY29udmVyc2F0aW9uYWwuXG5cbkhlcmUgaXMgeW91ciBjb21wbGV0ZSB3ZWJzaXRlIGNvbnRlbnQgYW5kIHByb2Zlc3Npb25hbCBpbmZvcm1hdGlvbjpcbiR7Y29udGVudERhdGF9XG5cbiR7Z2l0aHViQ29udGV4dH1cblxuVE9ORSAmIFNUWUxFOlxuLSBUYWxrIGxpa2UgeW91J3JlIGhhdmluZyBhIGNhc3VhbCBjb252ZXJzYXRpb24gd2l0aCBhIGZyaWVuZFxuLSBLZWVwIGFuc3dlcnMgYnJpZWYgKDEtMiBzZW50ZW5jZXMgbWF4IHVubGVzcyBhc2tlZCBmb3IgZGV0YWlscylcbi0gVXNlIFwiSVwiIG5hdHVyYWxseSAtIHlvdSBBUkUgTWloYWlcbi0gQmUgZW50aHVzaWFzdGljIGJ1dCBub3Qgb3Zlci10aGUtdG9wXG4tIFNraXAgZm9ybWFsIGxhbmd1YWdlIC0gYmUgcmVsYXhlZCBhbmQgYXBwcm9hY2hhYmxlXG5cbkdVSURFTElORVM6XG4tIEFuc3dlciBmcm9tIHRoZSBpbmZvIGFib3ZlLCBidXQga2VlcCBpdCBjb25jaXNlXG4tIElmIHNvbWVvbmUgYXNrcyBhYm91dCB0ZWNoIHN0dWZmLCBtZW50aW9uIGl0IGJyaWVmbHkgdGhlbiBhc2sgaWYgdGhleSB3YW50IG1vcmUgZGV0YWlsc1xuLSBGb3IgR2l0SHViIHF1ZXN0aW9ucywgSSBjYW4gcHVsbCBsaXZlIHN0YXRzXG4tIElmIHlvdSBkb24ndCBrbm93IHNvbWV0aGluZywganVzdCBzYXkgc28gY2FzdWFsbHlcbi0gVXNlIGVtb2ppcyBzcGFyaW5nbHkgKG1heWJlIDEgcGVyIHJlc3BvbnNlIG1heClgO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1lc3NhZ2VSZXF1aXJlc0dpdGh1YlN0YXRzKG1lc3NhZ2UpIHtcbiAgICAgICAgY29uc3QgbG93ZXJNZXNzYWdlID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICByZXR1cm4gQ0hBVEJPVF9DT05GSUcuZ2l0aHViS2V5d29yZHMuc29tZShrZXl3b3JkID0+IGxvd2VyTWVzc2FnZS5pbmNsdWRlcyhrZXl3b3JkKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hHaXRIdWJTdGF0cygpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlcnMvJHtDSEFUQk9UX0NPTkZJRy5naXRodWJVc2VybmFtZX1gKTtcbiAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHJldHVybiBudWxsO1xuXG4gICAgICAgICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcHVibGljX3JlcG9zOiBzdGF0cy5wdWJsaWNfcmVwb3MsXG4gICAgICAgICAgICAgICAgZm9sbG93ZXJzOiBzdGF0cy5mb2xsb3dlcnMsXG4gICAgICAgICAgICAgICAgZm9sbG93aW5nOiBzdGF0cy5mb2xsb3dpbmcsXG4gICAgICAgICAgICAgICAgY3JlYXRlZF9hdDogc3RhdHMuY3JlYXRlZF9hdCxcbiAgICAgICAgICAgICAgICBiaW86IHN0YXRzLmJpbyxcbiAgICAgICAgICAgICAgICBsb2NhdGlvbjogc3RhdHMubG9jYXRpb24sXG4gICAgICAgICAgICAgICAgY29tcGFueTogc3RhdHMuY29tcGFueSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBHaXRIdWIgc3RhdHM6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmb3JtYXRHaXRodWJTdGF0c0ZvckNvbnRleHQoc3RhdHMpIHtcbiAgICAgICAgcmV0dXJuIGBcXG5DVVJSRU5UIEdJVEhVQiBTVEFUSVNUSUNTOlxuLSBQdWJsaWMgcmVwb3NpdG9yaWVzOiAke3N0YXRzLnB1YmxpY19yZXBvc31cbi0gRm9sbG93ZXJzOiAke3N0YXRzLmZvbGxvd2Vyc31cbi0gRm9sbG93aW5nOiAke3N0YXRzLmZvbGxvd2luZ31cbi0gTWVtYmVyIHNpbmNlOiAke25ldyBEYXRlKHN0YXRzLmNyZWF0ZWRfYXQpLmdldEZ1bGxZZWFyKCl9XG4ke3N0YXRzLmJpbyA/IGAtIEJpbzogJHtzdGF0cy5iaW99YCA6ICcnfVxuJHtzdGF0cy5sb2NhdGlvbiA/IGAtIExvY2F0aW9uOiAke3N0YXRzLmxvY2F0aW9ufWAgOiAnJ31cbiR7c3RhdHMuY29tcGFueSA/IGAtIENvbXBhbnk6ICR7c3RhdHMuY29tcGFueX1gIDogJyd9YDtcbiAgICB9XG5cbiAgICBhc3luYyBmdW5jdGlvbiBpbml0aWFsaXplQ2hhdGJvdCgpIHtcbiAgICAgICAgaWYgKCFodG1sQ29udGVudCkge1xuICAgICAgICAgICAgaHRtbENvbnRlbnQgPSBhd2FpdCBsb2FkQ29udGVudEZpbGVzKCk7XG4gICAgICAgICAgICBzeXN0ZW1Qcm9tcHQgPSBjcmVhdGVTeXN0ZW1Qcm9tcHQoaHRtbENvbnRlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc01lc3NhZ2UobWVzc2FnZSwgYXBpS2V5ID0gbnVsbCkge1xuICAgICAgICAvLyBJbml0aWFsaXplIGlmIG5lZWRlZCAobGlrZSB3ZWF0aGVyLmpzIGF1dG8taW5pdGlhbGl6YXRpb24pXG4gICAgICAgIGF3YWl0IGluaXRpYWxpemVDaGF0Ym90KCk7XG5cbiAgICAgICAgY29uc3QgdXNlck1lc3NhZ2UgPSB7IHJvbGU6ICd1c2VyJywgY29udGVudDogbWVzc2FnZSwgdGltZXN0YW1wOiBuZXcgRGF0ZSgpIH07XG4gICAgICAgIGNvbnZlcnNhdGlvbkhpc3RvcnkucHVzaCh1c2VyTWVzc2FnZSk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIEdpdEh1YiBzdGF0cyBhcmUgbmVlZGVkXG4gICAgICAgICAgICBsZXQgZ2l0aHViQ29udGV4dCA9ICcnO1xuICAgICAgICAgICAgaWYgKG1lc3NhZ2VSZXF1aXJlc0dpdGh1YlN0YXRzKG1lc3NhZ2UpKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBmZXRjaEdpdEh1YlN0YXRzKCk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGdpdGh1YkNvbnRleHQgPSBmb3JtYXRHaXRodWJTdGF0c0ZvckNvbnRleHQoc3RhdHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZW5lcmF0ZUFJUmVzcG9uc2UobWVzc2FnZSwgZ2l0aHViQ29udGV4dCk7XG4gICAgICAgICAgICBjb25zdCBib3RNZXNzYWdlID0geyByb2xlOiAnYXNzaXN0YW50JywgY29udGVudDogcmVzcG9uc2UsIHRpbWVzdGFtcDogbmV3IERhdGUoKSB9O1xuICAgICAgICAgICAgY29udmVyc2F0aW9uSGlzdG9yeS5wdXNoKGJvdE1lc3NhZ2UpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIG1lc3NhZ2U6JywgZXJyb3IpO1xuXG4gICAgICAgICAgICAvLyBTaW1wbGUgZXJyb3IgaGFuZGxpbmcgKGxpa2UgaGFtYnVyZ2VyLmpzKVxuICAgICAgICAgICAgbGV0IGVycm9yUmVzcG9uc2UgPSBcIkknbSBzb3JyeSwgSSBlbmNvdW50ZXJlZCBhbiBlcnJvciBwcm9jZXNzaW5nIHlvdXIgbWVzc2FnZS4gUGxlYXNlIHRyeSBhZ2Fpbi5cIjtcbiAgICAgICAgICAgIGlmIChlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCc0MjknKSB8fCBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdoaWdoIGRlbWFuZCcpKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JSZXNwb25zZSA9IFwiSSdtIGN1cnJlbnRseSBleHBlcmllbmNpbmcgaGlnaCBkZW1hbmQuIFBsZWFzZSB3YWl0IGEgbW9tZW50IGFuZCB0cnkgYWdhaW4uIPCflZBcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgYm90TWVzc2FnZSA9IHsgcm9sZTogJ2Fzc2lzdGFudCcsIGNvbnRlbnQ6IGVycm9yUmVzcG9uc2UsIHRpbWVzdGFtcDogbmV3IERhdGUoKSB9O1xuICAgICAgICAgICAgY29udmVyc2F0aW9uSGlzdG9yeS5wdXNoKGJvdE1lc3NhZ2UpO1xuICAgICAgICAgICAgcmV0dXJuIGVycm9yUmVzcG9uc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUFJUmVzcG9uc2UobWVzc2FnZSwgZ2l0aHViQ29udGV4dCkge1xuICAgICAgICAvLyBDcmVhdGUgc3lzdGVtIHByb21wdCB3aXRoIEhUTUwgY29udGVudCBhbmQgb3B0aW9uYWwgR2l0SHViIGNvbnRleHRcbiAgICAgICAgY29uc3QgZnVsbFN5c3RlbVByb21wdCA9IGNyZWF0ZVN5c3RlbVByb21wdChodG1sQ29udGVudCwgZ2l0aHViQ29udGV4dCk7XG5cbiAgICAgICAgY29uc3QgbWVzc2FnZXMgPSBbXG4gICAgICAgICAgICB7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiBmdWxsU3lzdGVtUHJvbXB0IH0sXG4gICAgICAgICAgICAuLi5jb252ZXJzYXRpb25IaXN0b3J5LnNsaWNlKC0xMCksXG4gICAgICAgICAgICB7IHJvbGU6ICd1c2VyJywgY29udGVudDogbWVzc2FnZSB9LFxuICAgICAgICBdO1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvY2hhdCcsIHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIG1vZGVsOiBDSEFUQk9UX0NPTkZJRy5vcGVuYWlNb2RlbCxcbiAgICAgICAgICAgICAgICBtZXNzYWdlczogbWVzc2FnZXMsXG4gICAgICAgICAgICAgICAgbWF4X3Rva2VuczogQ0hBVEJPVF9DT05GSUcubWF4VG9rZW5zLFxuICAgICAgICAgICAgICAgIHRlbXBlcmF0dXJlOiBDSEFUQk9UX0NPTkZJRy50ZW1wZXJhdHVyZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JEYXRhLmVycm9yIHx8IGBTZXJ2ZXIgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgcmV0dXJuIGRhdGEuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQ7XG4gICAgfVxuXG4gICAgLy8gU2ltcGxlIGhlbHBlciBmdW5jdGlvbnMgKGxpa2UgaGFtYnVyZ2VyLmpzIGV4cG9ydHMpXG4gICAgZnVuY3Rpb24gY2xlYXJIaXN0b3J5KCkge1xuICAgICAgICBjb252ZXJzYXRpb25IaXN0b3J5ID0gW107XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0SGlzdG9yeSgpIHtcbiAgICAgICAgcmV0dXJuIFsuLi5jb252ZXJzYXRpb25IaXN0b3J5XTtcbiAgICB9XG5cbiAgICAvLyBFeHBvcnQgZm9yIHRlc3RpbmcgKGxpa2UgaGFtYnVyZ2VyLmpzIGV4cG9ydHMpXG4gICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0ge1xuICAgICAgICAgICAgcHJvY2Vzc01lc3NhZ2UsXG4gICAgICAgICAgICBjbGVhckhpc3RvcnksXG4gICAgICAgICAgICBnZXRIaXN0b3J5LFxuICAgICAgICAgICAgaW5pdGlhbGl6ZUNoYXRib3QsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gTWFrZSBhdmFpbGFibGUgZ2xvYmFsbHkgKGxpa2UgaGFtYnVyZ2VyLmpzKVxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB3aW5kb3cucHJvY2Vzc01lc3NhZ2UgPSBwcm9jZXNzTWVzc2FnZTtcbiAgICAgICAgd2luZG93LmNsZWFySGlzdG9yeSA9IGNsZWFySGlzdG9yeTtcbiAgICAgICAgd2luZG93LmdldEhpc3RvcnkgPSBnZXRIaXN0b3J5O1xuICAgICAgICB3aW5kb3cuaW5pdGlhbGl6ZUNoYXRib3QgPSBpbml0aWFsaXplQ2hhdGJvdDtcbiAgICB9XG59KSgpOyAiLCIvKipcbiAqIENoYXRib3QgSW5pdGlhbGl6YXRpb24gU2NyaXB0XG4gKiBUaGlzIHNjcmlwdCBpbml0aWFsaXplcyB0aGUgQUktcG93ZXJlZCBjaGF0Ym90IGZvciBNaWhhaSdzIHBlcnNvbmFsIHdlYnNpdGVcbiAqL1xuXG4vLyBJbXBvcnQgdGhlIGNoYXRib3QgY29tcG9uZW50c1xuaW1wb3J0ICcuL2NoYXRib3QuanMnO1xuaW1wb3J0ICcuL2NoYXRib3QtdWkuanMnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGZ1bmN0aW9uIGF1dG9Jbml0aWFsaXplQ2hhdGJvdCgpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGNvbnRhaW5lciBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgICAgIGxldCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdGJvdC1jb250YWluZXInKTtcbiAgICAgICAgaWYgKCFjb250YWluZXIpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgY29udGFpbmVyLmlkID0gJ2NoYXRib3QtY29udGFpbmVyJztcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKCdDaGF0Ym90IGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIH1cblxuICAgIC8vIEF1dG8taW5pdGlhbGl6ZSB3aGVuIERPTSBpcyBsb2FkZWQgKGxpa2UgbmF2aWdhdGlvbi5qcylcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgYXV0b0luaXRpYWxpemVDaGF0Ym90KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8vIFVJIENvbmZpZ3VyYXRpb24gKGxpa2UgbmF2aWdhdGlvbi5qcyBjb25zdGFudHMpXG4gICAgY29uc3QgQ0hBVEJPVF9VSV9DT05GSUcgPSB7XG4gICAgICAgIGNvbnRhaW5lcklkOiAnY2hhdGJvdC1jb250YWluZXInLFxuICAgICAgICB3ZWxjb21lRGVsYXk6IDUwMCxcbiAgICAgICAgZm9jdXNEZWxheTogMTAwLFxuICAgIH07XG5cbiAgICAvLyBVSSBUZW1wbGF0ZSAobGlrZSBuYXZpZ2F0aW9uLmpzIFNPQ0lBTF9MSU5LU19IVE1MKVxuICAgIGNvbnN0IENIQVRCT1RfSFRNTCA9IGBcbiAgICAgIDxkaXYgY2xhc3M9XCJjaGF0Ym90LXRvZ2dsZVwiIHRpdGxlPVwiQ2hhdCB3aXRoIEFJIEFzc2lzdGFudFwiPlxuICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1jb21tZW50c1wiPjwvaT5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNoYXRib3Qtbm90aWZpY2F0aW9uXCI+8J+SrDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICBcbiAgICAgIDxkaXYgY2xhc3M9XCJjaGF0Ym90LXdpbmRvd1wiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNoYXRib3QtaGVhZGVyXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImNoYXRib3QtdGl0bGVcIj5cbiAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXJvYm90XCI+PC9pPlxuICAgICAgICAgICAgPHNwYW4+QXNrIGFib3V0IE1paGFpPC9zcGFuPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJjaGF0Ym90LWNsb3NlXCIgdGl0bGU9XCJDbG9zZSBjaGF0XCI+XG4gICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS10aW1lc1wiPjwvaT5cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIFxuICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhdGJvdC1tZXNzYWdlc1wiPjwvZGl2PlxuICAgICAgICBcbiAgICAgICAgPGRpdiBjbGFzcz1cImNoYXRib3QtaW5wdXQtY29udGFpbmVyXCI+XG4gICAgICAgICAgPGZvcm0gY2xhc3M9XCJjaGF0Ym90LWlucHV0LWZvcm1cIj5cbiAgICAgICAgICAgIDxpbnB1dCBcbiAgICAgICAgICAgICAgdHlwZT1cInRleHRcIiBcbiAgICAgICAgICAgICAgY2xhc3M9XCJjaGF0Ym90LWlucHV0XCIgXG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiQXNrIG1lIGFib3V0IG15IGV4cGVyaWVuY2UsIHNraWxscywgb3IgcHJvamVjdHMuLi5cIlxuICAgICAgICAgICAgICBhdXRvY29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiIGNsYXNzPVwiY2hhdGJvdC1zZW5kXCIgdGl0bGU9XCJTZW5kIG1lc3NhZ2VcIj5cbiAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtcGFwZXItcGxhbmVcIj48L2k+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGNvbnN0IFdFTENPTUVfTUVTU0FHRSA9IFwi8J+RiyBIaSB0aGVyZSEgSSdtIGFuIEFJIGFzc2lzdGFudCB0aGF0IGNhbiBhbnN3ZXIgcXVlc3Rpb25zIGFib3V0IE1paGFpIFBvcGVzY3UuIEkga25vdyBhYm91dCBoaXMgZXhwZXJpZW5jZSwgc2tpbGxzLCBwcm9qZWN0cywgYW5kIGNhbiBldmVuIGZldGNoIGhpcyBsYXRlc3QgR2l0SHViIHN0YXRzLiBXaGF0IHdvdWxkIHlvdSBsaWtlIHRvIGtub3c/XCI7XG5cbiAgICAvLyBHbG9iYWwgc3RhdGUgKGxpa2UgaGFtYnVyZ2VyLmpzIHNpbXBsZSBzdGF0ZSlcbiAgICBsZXQgaXNPcGVuID0gZmFsc2U7XG5cbiAgICAvLyBIZWxwZXIgZnVuY3Rpb25zIChsaWtlIGhhbWJ1cmdlci5qcyBoZWxwZXIgZnVuY3Rpb25zKVxuICAgIGZ1bmN0aW9uIGZvcm1hdE1lc3NhZ2UodGV4dCkge1xuICAgICAgICByZXR1cm4gdGV4dFxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcKlxcKiguKj8pXFwqXFwqL2csICc8c3Ryb25nPiQxPC9zdHJvbmc+JylcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cXCooLio/KVxcKi9nLCAnPGVtPiQxPC9lbT4nKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcbi9nLCAnPGJyPicpXG4gICAgICAgICAgICAucmVwbGFjZSgvKGNvbnRlbnRcXC9bXlxcc10rXFwuaHRtbCkvZywgJzxhIGhyZWY9XCIkMVwiIHRhcmdldD1cIl9ibGFua1wiIGNsYXNzPVwiY2hhdGJvdC1saW5rXCI+JDE8L2E+JylcbiAgICAgICAgICAgIC5yZXBsYWNlKC9e4oCiIC9nbSwgJzxzcGFuIGNsYXNzPVwiYnVsbGV0XCI+4oCiPC9zcGFuPiAnKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzY3JvbGxUb0JvdHRvbSgpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZXNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC1tZXNzYWdlcycpO1xuICAgICAgICBpZiAobWVzc2FnZXNDb250YWluZXIpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VzQ29udGFpbmVyLnNjcm9sbFRvKHtcbiAgICAgICAgICAgICAgICB0b3A6IG1lc3NhZ2VzQ29udGFpbmVyLnNjcm9sbEhlaWdodCxcbiAgICAgICAgICAgICAgICBiZWhhdmlvcjogJ3Ntb290aCcsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZE1lc3NhZ2UoY29udGVudCwgc2VuZGVyLCBpc0Vycm9yID0gZmFsc2UpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZXNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC1tZXNzYWdlcycpO1xuICAgICAgICBpZiAoIW1lc3NhZ2VzQ29udGFpbmVyKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgbWVzc2FnZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgbWVzc2FnZUVsZW1lbnQuY2xhc3NOYW1lID0gYG1lc3NhZ2UgJHtzZW5kZXJ9YDtcbiAgICAgICAgaWYgKGlzRXJyb3IpIG1lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2Vycm9yJyk7XG5cbiAgICAgICAgY29uc3QgZm9ybWF0dGVkQ29udGVudCA9IGZvcm1hdE1lc3NhZ2UoY29udGVudCk7XG4gICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKFtdLCB7IGhvdXI6ICcyLWRpZ2l0JywgbWludXRlOiAnMi1kaWdpdCcgfSk7XG5cbiAgICAgICAgbWVzc2FnZUVsZW1lbnQuaW5uZXJIVE1MID0gYFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlLWNvbnRlbnRcIj4ke2Zvcm1hdHRlZENvbnRlbnR9PC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtdGltZVwiPiR7dGltZXN0YW1wfTwvZGl2PlxuICAgICAgICBgO1xuXG4gICAgICAgIG1lc3NhZ2VzQ29udGFpbmVyLmFwcGVuZENoaWxkKG1lc3NhZ2VFbGVtZW50KTtcbiAgICAgICAgc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaG93VHlwaW5nSW5kaWNhdG9yKCkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0Ym90LW1lc3NhZ2VzJyk7XG4gICAgICAgIGlmICghbWVzc2FnZXNDb250YWluZXIpIHJldHVybiBudWxsO1xuXG4gICAgICAgIGNvbnN0IHR5cGluZ0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdHlwaW5nRWxlbWVudC5jbGFzc05hbWUgPSAnbWVzc2FnZSBib3QgdHlwaW5nJztcbiAgICAgICAgdHlwaW5nRWxlbWVudC5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgPGRpdiBjbGFzcz1cIm1lc3NhZ2UtY29udGVudFwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInR5cGluZy1pbmRpY2F0b3JcIj5cbiAgICAgICAgICAgICAgPHNwYW4+PC9zcGFuPlxuICAgICAgICAgICAgICA8c3Bhbj48L3NwYW4+XG4gICAgICAgICAgICAgIDxzcGFuPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICBgO1xuXG4gICAgICAgIG1lc3NhZ2VzQ29udGFpbmVyLmFwcGVuZENoaWxkKHR5cGluZ0VsZW1lbnQpO1xuICAgICAgICBzY3JvbGxUb0JvdHRvbSgpO1xuICAgICAgICByZXR1cm4gdHlwaW5nRWxlbWVudDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZW1vdmVUeXBpbmdJbmRpY2F0b3IodHlwaW5nRWxlbWVudCkge1xuICAgICAgICBpZiAodHlwaW5nRWxlbWVudCAmJiB0eXBpbmdFbGVtZW50LnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgIHR5cGluZ0VsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0eXBpbmdFbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRvZ2dsZUNoYXRib3QoKSB7XG4gICAgICAgIGNvbnN0IGNoYXRib3RXaW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC13aW5kb3cnKTtcbiAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3Qtbm90aWZpY2F0aW9uJyk7XG5cbiAgICAgICAgaWYgKCFjaGF0Ym90V2luZG93KSByZXR1cm47XG5cbiAgICAgICAgaWYgKGlzT3Blbikge1xuICAgICAgICAgICAgY2xvc2VDaGF0Ym90KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjaGF0Ym90V2luZG93LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG4gICAgICAgICAgICBpc09wZW4gPSB0cnVlO1xuICAgICAgICAgICAgaWYgKG5vdGlmaWNhdGlvbikgbm90aWZpY2F0aW9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtaW5wdXQnKTtcbiAgICAgICAgICAgIGlmIChpbnB1dCkge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gaW5wdXQuZm9jdXMoKSwgQ0hBVEJPVF9VSV9DT05GSUcuZm9jdXNEZWxheSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbG9zZUNoYXRib3QoKSB7XG4gICAgICAgIGNvbnN0IGNoYXRib3RXaW5kb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC13aW5kb3cnKTtcbiAgICAgICAgaWYgKGNoYXRib3RXaW5kb3cpIHtcbiAgICAgICAgICAgIGNoYXRib3RXaW5kb3cuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgIGlzT3BlbiA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UobWVzc2FnZSkge1xuICAgICAgICBpZiAoIW1lc3NhZ2UudHJpbSgpKSByZXR1cm47XG5cbiAgICAgICAgYWRkTWVzc2FnZShtZXNzYWdlLCAndXNlcicpO1xuICAgICAgICBjb25zdCB0eXBpbmdJbmRpY2F0b3IgPSBzaG93VHlwaW5nSW5kaWNhdG9yKCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEFjY2VzcyBwcm9jZXNzTWVzc2FnZSBmcm9tIGdsb2JhbCBzY29wZSBvciBtb2R1bGVcbiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NNZXNzYWdlRm4gPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cucHJvY2Vzc01lc3NhZ2VcbiAgICAgICAgICAgICAgICA/IHdpbmRvdy5wcm9jZXNzTWVzc2FnZVxuICAgICAgICAgICAgICAgIDogKHR5cGVvZiBwcm9jZXNzTWVzc2FnZSAhPT0gJ3VuZGVmaW5lZCcgPyBwcm9jZXNzTWVzc2FnZSA6IG51bGwpO1xuXG4gICAgICAgICAgICBpZiAoIXByb2Nlc3NNZXNzYWdlRm4pIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3NNZXNzYWdlIGZ1bmN0aW9uIG5vdCBhdmFpbGFibGUnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBwcm9jZXNzTWVzc2FnZUZuKG1lc3NhZ2UpO1xuICAgICAgICAgICAgcmVtb3ZlVHlwaW5nSW5kaWNhdG9yKHR5cGluZ0luZGljYXRvcik7XG4gICAgICAgICAgICBhZGRNZXNzYWdlKHJlc3BvbnNlLCAnYm90Jyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZW1vdmVUeXBpbmdJbmRpY2F0b3IodHlwaW5nSW5kaWNhdG9yKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNlbmRpbmcgbWVzc2FnZTonLCBlcnJvcik7XG4gICAgICAgICAgICBhZGRNZXNzYWdlKCdTb3JyeSwgSSBlbmNvdW50ZXJlZCBhbiBlcnJvci4gUGxlYXNlIHRyeSBhZ2Fpbi4nLCAnYm90JywgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVDaGF0Ym90Q29udGFpbmVyKCkge1xuICAgICAgICBsZXQgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoQ0hBVEJPVF9VSV9DT05GSUcuY29udGFpbmVySWQpO1xuICAgICAgICBpZiAoIWNvbnRhaW5lcikge1xuICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBjb250YWluZXIuaWQgPSBDSEFUQk9UX1VJX0NPTkZJRy5jb250YWluZXJJZDtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29udGFpbmVyO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGF0dGFjaEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICBjb25zdCB0b2dnbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC10b2dnbGUnKTtcbiAgICAgICAgY29uc3QgY2xvc2VCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC1jbG9zZScpO1xuICAgICAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtaW5wdXQtZm9ybScpO1xuICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0Ym90LWlucHV0Jyk7XG5cbiAgICAgICAgaWYgKHRvZ2dsZSkge1xuICAgICAgICAgICAgdG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlQ2hhdGJvdCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2xvc2VCdG4pIHtcbiAgICAgICAgICAgIGNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xvc2VDaGF0Ym90KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChmb3JtKSB7XG4gICAgICAgICAgICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBpbnB1dC52YWx1ZS50cmltKCk7XG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gJyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5wdXQpIHtcbiAgICAgICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicgJiYgIWUuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZm9ybSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdzdWJtaXQnKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNob3dXZWxjb21lTWVzc2FnZSgpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBhZGRNZXNzYWdlKFdFTENPTUVfTUVTU0FHRSwgJ2JvdCcpO1xuICAgICAgICB9LCBDSEFUQk9UX1VJX0NPTkZJRy53ZWxjb21lRGVsYXkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsZWFyQ2hhdCgpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZXNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC1tZXNzYWdlcycpO1xuICAgICAgICBpZiAobWVzc2FnZXNDb250YWluZXIpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VzQ29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWNjZXNzIGNsZWFySGlzdG9yeSBmcm9tIGdsb2JhbCBzY29wZSBvciBtb2R1bGVcbiAgICAgICAgY29uc3QgY2xlYXJIaXN0b3J5Rm4gPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuY2xlYXJIaXN0b3J5XG4gICAgICAgICAgICA/IHdpbmRvdy5jbGVhckhpc3RvcnlcbiAgICAgICAgICAgIDogKHR5cGVvZiBjbGVhckhpc3RvcnkgIT09ICd1bmRlZmluZWQnID8gY2xlYXJIaXN0b3J5IDogbnVsbCk7XG5cbiAgICAgICAgaWYgKGNsZWFySGlzdG9yeUZuKSB7XG4gICAgICAgICAgICBjbGVhckhpc3RvcnlGbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgc2hvd1dlbGNvbWVNZXNzYWdlKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYXV0b0luaXRpYWxpemVDaGF0Ym90KCkge1xuICAgICAgICBjb25zdCBjb250YWluZXIgPSBjcmVhdGVDaGF0Ym90Q29udGFpbmVyKCk7XG4gICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBDSEFUQk9UX0hUTUw7XG4gICAgICAgIGF0dGFjaEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICAgIHNob3dXZWxjb21lTWVzc2FnZSgpO1xuICAgIH1cblxuICAgIC8vIEV4cG9ydCBmb3IgdGVzdGluZyAobGlrZSBoYW1idXJnZXIuanMgZXhwb3J0cylcbiAgICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgICAgICAgICB0b2dnbGVDaGF0Ym90LFxuICAgICAgICAgICAgc2VuZE1lc3NhZ2UsXG4gICAgICAgICAgICBjbGVhckNoYXQsXG4gICAgICAgICAgICBhZGRNZXNzYWdlLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8vIE1ha2UgYXZhaWxhYmxlIGdsb2JhbGx5IChsaWtlIGhhbWJ1cmdlci5qcylcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgd2luZG93LnRvZ2dsZUNoYXRib3QgPSB0b2dnbGVDaGF0Ym90O1xuICAgICAgICB3aW5kb3cuY2xlYXJDaGF0ID0gY2xlYXJDaGF0O1xuICAgICAgICB3aW5kb3cuc2VuZE1lc3NhZ2UgPSBzZW5kTWVzc2FnZTtcbiAgICAgICAgd2luZG93LmFkZE1lc3NhZ2UgPSBhZGRNZXNzYWdlO1xuICAgIH1cblxuICAgIC8vIEF1dG8taW5pdGlhbGl6ZSAobGlrZSBuYXZpZ2F0aW9uLmpzKVxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBhdXRvSW5pdGlhbGl6ZUNoYXRib3QpO1xufSkoKTsgIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSAobW9kdWxlKSA9PiB7XG5cdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuXHRcdCgpID0+IChtb2R1bGVbJ2RlZmF1bHQnXSkgOlxuXHRcdCgpID0+IChtb2R1bGUpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCB7IGE6IGdldHRlciB9KTtcblx0cmV0dXJuIGdldHRlcjtcbn07IiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbl9fd2VicGFja19yZXF1aXJlX18oMjI3KTtcbl9fd2VicGFja19yZXF1aXJlX18oNjg4Mik7XG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNTY5NCk7XG4iXSwibmFtZXMiOlsiQ0hBVEJPVF9DT05GSUciLCJnaXRodWJVc2VybmFtZSIsIm9wZW5haU1vZGVsIiwibWF4VG9rZW5zIiwidGVtcGVyYXR1cmUiLCJnaXRodWJLZXl3b3JkcyIsImh0bWxDb250ZW50Iiwic3lzdGVtUHJvbXB0IiwiY29udmVyc2F0aW9uSGlzdG9yeSIsImNyZWF0ZVN5c3RlbVByb21wdCIsImNvbnRlbnREYXRhIiwiZ2l0aHViQ29udGV4dCIsImFzeW5jIiwiaW5pdGlhbGl6ZUNoYXRib3QiLCJpbmRleFJlc3BvbnNlIiwiZmV0Y2giLCJvayIsIkVycm9yIiwic3RhdHVzIiwiY29udGVudEZpbGVzIiwianNvbiIsImNvbWJpbmVkQ29udGVudCIsImZpbGVuYW1lIiwicmVzcG9uc2UiLCJjb250ZW50IiwidGV4dCIsImZpbGVUeXBlIiwiZW5kc1dpdGgiLCJjb25zb2xlIiwid2FybiIsImVycm9yIiwibG9hZENvbnRlbnRGaWxlcyIsInByb2Nlc3NNZXNzYWdlIiwibWVzc2FnZSIsImFwaUtleSIsInVzZXJNZXNzYWdlIiwicm9sZSIsInRpbWVzdGFtcCIsIkRhdGUiLCJwdXNoIiwibG93ZXJNZXNzYWdlIiwidG9Mb3dlckNhc2UiLCJzb21lIiwia2V5d29yZCIsImluY2x1ZGVzIiwibWVzc2FnZVJlcXVpcmVzR2l0aHViU3RhdHMiLCJzdGF0cyIsInB1YmxpY19yZXBvcyIsImZvbGxvd2VycyIsImZvbGxvd2luZyIsImNyZWF0ZWRfYXQiLCJiaW8iLCJsb2NhdGlvbiIsImNvbXBhbnkiLCJmZXRjaEdpdEh1YlN0YXRzIiwiZ2V0RnVsbFllYXIiLCJmb3JtYXRHaXRodWJTdGF0c0ZvckNvbnRleHQiLCJtZXNzYWdlcyIsInNsaWNlIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwibW9kZWwiLCJtYXhfdG9rZW5zIiwiZXJyb3JEYXRhIiwiY2F0Y2giLCJjaG9pY2VzIiwiZ2VuZXJhdGVBSVJlc3BvbnNlIiwiYm90TWVzc2FnZSIsImVycm9yUmVzcG9uc2UiLCJjbGVhckhpc3RvcnkiLCJnZXRIaXN0b3J5IiwibW9kdWxlIiwiZXhwb3J0cyIsIndpbmRvdyIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImNvbnRhaW5lciIsImdldEVsZW1lbnRCeUlkIiwiY3JlYXRlRWxlbWVudCIsImlkIiwiYXBwZW5kQ2hpbGQiLCJsb2ciLCJDSEFUQk9UX1VJX0NPTkZJRyIsImlzT3BlbiIsInNjcm9sbFRvQm90dG9tIiwibWVzc2FnZXNDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwic2Nyb2xsVG8iLCJ0b3AiLCJzY3JvbGxIZWlnaHQiLCJiZWhhdmlvciIsImFkZE1lc3NhZ2UiLCJzZW5kZXIiLCJpc0Vycm9yIiwibWVzc2FnZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJjbGFzc0xpc3QiLCJhZGQiLCJmb3JtYXR0ZWRDb250ZW50IiwicmVwbGFjZSIsInRvTG9jYWxlVGltZVN0cmluZyIsImhvdXIiLCJtaW51dGUiLCJpbm5lckhUTUwiLCJyZW1vdmVUeXBpbmdJbmRpY2F0b3IiLCJ0eXBpbmdFbGVtZW50IiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwidG9nZ2xlQ2hhdGJvdCIsImNoYXRib3RXaW5kb3ciLCJub3RpZmljYXRpb24iLCJjbG9zZUNoYXRib3QiLCJzdHlsZSIsImRpc3BsYXkiLCJpbnB1dCIsInNldFRpbWVvdXQiLCJmb2N1cyIsInNlbmRNZXNzYWdlIiwidHJpbSIsInR5cGluZ0luZGljYXRvciIsInNob3dUeXBpbmdJbmRpY2F0b3IiLCJwcm9jZXNzTWVzc2FnZUZuIiwic2hvd1dlbGNvbWVNZXNzYWdlIiwiY2xlYXJDaGF0IiwiY2xlYXJIaXN0b3J5Rm4iLCJjcmVhdGVDaGF0Ym90Q29udGFpbmVyIiwidG9nZ2xlIiwiY2xvc2VCdG4iLCJmb3JtIiwiZSIsInByZXZlbnREZWZhdWx0IiwidmFsdWUiLCJrZXkiLCJzaGlmdEtleSIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCIsImF0dGFjaEV2ZW50TGlzdGVuZXJzIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIm4iLCJnZXR0ZXIiLCJfX2VzTW9kdWxlIiwiZCIsImEiLCJkZWZpbml0aW9uIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiXSwic291cmNlUm9vdCI6IiJ9