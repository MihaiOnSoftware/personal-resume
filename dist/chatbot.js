(()=>{var t={227:t=>{!function(){"use strict";const e={githubUsername:"MihaiOnSoftware",openaiModel:"gpt-3.5-turbo",maxTokens:150,temperature:.1,githubKeywords:["github","repository","repo","repositories","code","commits","contributions","followers","following","projects"],github:{baseUrl:"https://api.github.com",repoLimit:10,eventLimit:5,displayRepoLimit:5,displayActivityLimit:3}};class n{constructor(){this.htmlContent=null,this.systemPrompt=null,this.conversationHistory=[]}async loadContentIndex(){const t=await fetch("html-files-index.json");if(!t.ok)throw new Error(`Failed to load content files index: ${t.status}`);return t.json()}async loadSingleContentFile(t){const e=await fetch(t),n=await e.text(),o=t.endsWith(".md")?"Markdown":"HTML";return`\n\n=== Content from ${t} (${o}) ===\n${n}`}async loadAllContentFiles(t){let e="";for(const n of t)e+=await this.loadSingleContentFile(n);return e}async loadContentFiles(){const t=await this.loadContentIndex();return this.loadAllContentFiles(t)}createSystemPrompt(t,e=""){return`\n            You are Mihai Popescu, a software developer, chatting casually about yourself. Keep responses short and conversational.\n\n            Here is your complete website content and professional information:\n            ${t}\n\n            ${e}\n\n            TONE & STYLE:\n            - Talk like you're having a casual conversation with a friend\n            - Keep answers brief (1-2 sentences max unless asked for details)\n            - Use "I" naturally - you ARE Mihai\n            - Be enthusiastic but not over-the-top\n            - Skip formal language - be relaxed and approachable\n\n            CRITICAL GUIDELINES - FOLLOW THESE STRICTLY:\n            - NEVER make up, invent, or guess at information not provided above\n            - If asked about personal details not in the content (like favorite food, movies, etc.), respond with "I don't have that information in my background" or "That's not something I've shared"\n            - ONLY answer based on the exact information provided above\n            - Do not fill in gaps with creative details or assumptions\n            - For GitHub questions, I can show recent activity and repository info\n            - If someone asks about tech stuff, mention it briefly then ask if they want more details\n            - Use emojis sparingly (maybe 1 per response max)\n            - When unsure, always err on the side of saying you don't know rather than guessing\n\n            EXAMPLES OF WHAT NOT TO DO:\n            - Don't make up favorite foods, movies, or personal preferences not mentioned\n            - Don't invent stories or experiences not in the content\n            - Don't speculate about opinions or feelings not explicitly stated\n            `}messageRequiresGithubStats(t){const n=t.toLowerCase();return e.githubKeywords.some(t=>n.includes(t))}buildGitHubUrl(t){return`${e.github.baseUrl}/users/${e.githubUsername}${t}`}async fetchGitHubData(t,e){try{const e=await fetch(t);return e.ok?await e.json():null}catch(t){return console.error(e,t),null}}async fetchGitHubStats(){try{const t=await this.fetchGitHubData(this.buildGitHubUrl(""),"Error fetching GitHub profile:");if(!t)return null;const[e,n]=await Promise.allSettled([this.fetchGitHubRepos(),this.fetchGitHubEvents()]);return{...this.extractBasicProfile(t),repositories:"fulfilled"===e.status?e.value:null,recent_activity:"fulfilled"===n.status?n.value:null}}catch(t){return console.error("Error fetching GitHub stats:",t),null}}extractBasicProfile(t){return{public_repos:t.public_repos,followers:t.followers,following:t.following,created_at:t.created_at,bio:t.bio,location:t.location,company:t.company}}async fetchGitHubRepos(){const t=this.buildGitHubUrl(`/repos?sort=updated&per_page=${e.github.repoLimit}`),n=await this.fetchGitHubData(t,"Error fetching GitHub repositories:");return n?n.map(this.transformRepo):null}async fetchGitHubEvents(){const t=this.buildGitHubUrl(`/events?per_page=${e.github.eventLimit}`),n=await this.fetchGitHubData(t,"Error fetching GitHub events:");return n?n.map(this.transformEvent.bind(this)).filter(t=>t.repo):null}transformRepo(t){return{name:t.name,description:t.description,language:t.language,stars:t.stargazers_count,updated_at:t.updated_at,url:t.html_url}}transformEvent(t){return{type:t.type,repo:t.repo?.name,created_at:t.created_at,action:this.formatEventAction(t)}}formatEventAction(t){switch(t.type){case"PushEvent":const e=t.payload?.commits?.length||0;return`Pushed ${e} commit${1!==e?"s":""}`;case"CreateEvent":return`Created ${t.payload?.ref_type} ${t.payload?.ref}`;case"PullRequestEvent":return`${t.payload?.action} pull request`;case"IssuesEvent":return`${t.payload?.action} issue`;case"ForkEvent":return"Forked repository";case"WatchEvent":return"Starred repository";default:return t.type.replace("Event","")}}formatGithubStatsForContext(t){return[this.formatBasicGitHubStats(t),this.formatRepositoriesSection(t.repositories),this.formatActivitySection(t.recent_activity)].filter(Boolean).join("\n")}formatBasicGitHubStats(t){return`\n            CURRENT GITHUB STATISTICS:\n            - Public repositories: ${t.public_repos}\n            - Followers: ${t.followers}\n            - Following: ${t.following}\n            - Member since: ${new Date(t.created_at).getFullYear()}\n            - Bio: ${t.bio}\n            - Location: ${t.location}\n            - Company: ${t.company}\n            `}formatRepositoriesSection(t){return t?.length?`\n            RECENT REPOSITORIES:\n            ${t.slice(0,e.github.displayRepoLimit).map(this.formatRepository).join("\n            ")}`:null}formatRepository(t){return[`- ${t.name}`,t.language?`(${t.language})`:"",t.description?`- ${t.description}`:"",t.stars>0?`â­${t.stars}`:"",`(Updated: ${new Date(t.updated_at).toLocaleDateString()})`].filter(Boolean).join(" ")}formatActivitySection(t){if(!t?.length)return"\n            NOTE: No recent public GitHub activity to display.";const e=this.calculateActivityStats(t);return`\n            RECENT ACTIVITY SUMMARY:\n            - Recent actions: ${e.totalActions}\n            - Active repositories: ${e.activeRepos}\n            - Most recent activity: ${e.mostRecentDate}\n            - Activity types: ${e.activityTypes.join(", ")}`}calculateActivityStats(t){const e={totalActions:0,activeRepos:new Set,activityTypes:new Set,mostRecentDate:null};return t.forEach(t=>{e.totalActions++;const n=t.type.replace("Event","");e.activityTypes.add(n);const o=t.repo.replace("MihaiOnSoftware/","");e.activeRepos.add(o);const s=new Date(t.created_at);(!e.mostRecentDate||s>e.mostRecentDate)&&(e.mostRecentDate=s)}),{totalActions:e.totalActions,activeRepos:e.activeRepos.size,activityTypes:Array.from(e.activityTypes),mostRecentDate:e.mostRecentDate?e.mostRecentDate.toLocaleDateString():"Unknown"}}async initialize(){this.htmlContent||(this.htmlContent=await this.loadContentFiles(),this.systemPrompt=this.createSystemPrompt(this.htmlContent))}addMessageToHistory(t,e){const n={role:t,content:e,timestamp:new Date};return this.conversationHistory.push(n),n}async getGithubContextIfNeeded(t){if(!this.messageRequiresGithubStats(t))return"";const e=await this.fetchGitHubStats();return e?this.formatGithubStatsForContext(e):""}createErrorResponse(t){return t.message.includes("429")||t.message.includes("high demand")?"I'm currently experiencing high demand. Please wait a moment and try again. ðŸ•":"I'm sorry, I encountered an error processing your message. Please try again."}async processMessage(t){await this.initialize(),this.addMessageToHistory("user",t);try{const e=await this.getGithubContextIfNeeded(t),n=await this.generateAIResponse(t,e);return this.addMessageToHistory("assistant",n),n}catch(t){console.error("Error processing message:",t);const e=this.createErrorResponse(t);return this.addMessageToHistory("assistant",e),e}}buildMessagesForAI(t,e){return[{role:"system",content:this.createSystemPrompt(this.htmlContent,e)},...this.conversationHistory.slice(-10),{role:"user",content:t}]}async callOpenAIAPI(t){const n=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e.openaiModel,messages:t,max_tokens:e.maxTokens,temperature:e.temperature})});if(!n.ok){const t=await n.json().catch(()=>({}));throw new Error(t.error||`Server error: ${n.status}`)}return(await n.json()).choices[0].message.content}async generateAIResponse(t,e){const n=this.buildMessagesForAI(t,e);return this.callOpenAIAPI(n)}clearHistory(){this.conversationHistory=[]}getHistory(){return[...this.conversationHistory]}}let o=null;function s(){return o||(o=new n),o}async function i(t){return s().processMessage(t)}function a(){s().clearHistory()}function r(){return s().getHistory()}async function c(){return s().initialize()}t.exports&&(t.exports={Chatbot:n,processMessage:i,clearHistory:a,getHistory:r,initializeChatbot:c}),"undefined"!=typeof window&&(window.processMessage=i,window.clearHistory=a,window.getHistory=r,window.initializeChatbot=c)}()},5694:(t,e,n)=>{"use strict";n(227),n(6882),document.addEventListener("DOMContentLoaded",function(){let t=document.getElementById("chatbot-container");t||(t=document.createElement("div"),t.id="chatbot-container",document.body.appendChild(t)),console.log("Chatbot initialized successfully")})},6882:t=>{!function(){"use strict";const e="chatbot-container";let n=!1;function o(){const t=document.querySelector(".chatbot-messages");t&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}function s(t,e,n=!1){const s=document.querySelector(".chatbot-messages");if(!s)return;const i=document.createElement("div");i.className=`message ${e}`,n&&i.classList.add("error");const a=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>").replace(/(content\/[^\s]+\.html)/g,'<a href="$1" target="_blank" class="chatbot-link">$1</a>').replace(/^â€¢ /gm,'<span class="bullet">â€¢</span> '),r=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});i.innerHTML=`\n          <div class="message-content">${a}</div>\n          <div class="message-time">${r}</div>\n        `,s.appendChild(i),o()}function i(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function a(){const t=document.querySelector(".chatbot-window");if(t)if(n)r();else{t.style.display="flex",n=!0;const e=document.querySelector(".chatbot-input");e&&setTimeout(()=>e.focus(),100)}}function r(){const t=document.querySelector(".chatbot-window");t&&(t.style.display="none",n=!1)}async function c(t){if(!t.trim())return;s(t,"user");const e=function(){const t=document.querySelector(".chatbot-messages");if(!t)return null;const e=document.createElement("div");return e.className="message bot typing",e.innerHTML='\n          <div class="message-content">\n            <div class="typing-indicator">\n              <span></span>\n              <span></span>\n              <span></span>\n            </div>\n          </div>\n        ',t.appendChild(e),o(),e}();try{const n="undefined"!=typeof window&&window.processMessage?window.processMessage:"undefined"!=typeof processMessage?processMessage:null;if(!n)throw new Error("processMessage function not available");const o=await n(t);i(e),s(o,"bot")}catch(t){i(e),console.error("Error sending message:",t),s("Sorry, I encountered an error. Please try again.","bot",!0)}}function l(){setTimeout(()=>{s("ðŸ‘‹ Hi there! I'm an AI assistant that can answer questions about Mihai Popescu. I know about his experience, skills, projects, and can tell you about his recent GitHub activity. What would you like to know?","bot")},500)}function u(){const t=document.querySelector(".chatbot-messages");t&&(t.innerHTML="");const e="undefined"!=typeof window&&window.clearHistory?window.clearHistory:"undefined"!=typeof clearHistory?clearHistory:null;e&&e(),l()}t.exports&&(t.exports={toggleChatbot:a,sendMessage:c,clearChat:u,addMessage:s}),"undefined"!=typeof window&&(window.toggleChatbot=a,window.clearChat=u,window.sendMessage=c,window.addMessage=s),document.addEventListener("DOMContentLoaded",function(){(function(){let t=document.getElementById(e);return t||(t=document.createElement("div"),t.id=e,document.body.appendChild(t)),t}()).innerHTML='\n      <div class="chatbot-toggle" title="Chat with AI Assistant">\n        <i class="fas fa-comments"></i>\n      </div>\n      \n      <div class="chatbot-window" style="display: none;">\n        <div class="chatbot-header">\n          <div class="chatbot-title">\n            <i class="fas fa-robot"></i>\n            <span>Ask about Mihai</span>\n          </div>\n          <button class="chatbot-close" title="Close chat">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        \n        <div class="chatbot-messages"></div>\n        \n        <div class="chatbot-input-container">\n          <form class="chatbot-input-form">\n            <input \n              type="text" \n              class="chatbot-input" \n              placeholder="Ask me about my experience, skills, or projects..."\n              autocomplete="off"\n            />\n            <button type="submit" class="chatbot-send" title="Send message">\n              <i class="fas fa-paper-plane"></i>\n            </button>\n          </form>\n        </div>\n      </div>\n    ',function(){const t=document.querySelector(".chatbot-toggle"),e=document.querySelector(".chatbot-close"),n=document.querySelector(".chatbot-input-form"),o=document.querySelector(".chatbot-input");t&&t.addEventListener("click",a),e&&e.addEventListener("click",r),n&&n.addEventListener("submit",t=>{t.preventDefault();const e=o.value.trim();e&&(c(e),o.value="")}),o&&o.addEventListener("keypress",t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),n&&n.dispatchEvent(new Event("submit")))})}(),l()})}()}},e={};function n(o){var s=e[o];if(void 0!==s)return s.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n(227),n(6882),n(5694)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WSxFQUFNQyxJQUFLTCxFQUFXaEIsTUNKM0VNLEVBQW9CVyxFQUFJLENBQUNLLEVBQUtDLElBQVVMLE9BQU9NLFVBQVVDLGVBQWVDLEtBQUtKLEVBQUtDLEdDR2xGakIsRUFBb0IsS0FDcEJBLEVBQW9CLE1BQ01BLEVBQW9CLEsiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9taWhhaS1yZXN1bWUvLi9zcmMvY2hhdGJvdC5qcyIsIndlYnBhY2s6Ly9taWhhaS1yZXN1bWUvLi9zcmMvY2hhdGJvdC1pbml0LmpzIiwid2VicGFjazovL21paGFpLXJlc3VtZS8uL3NyYy9jaGF0Ym90LXVpLmpzIiwid2VicGFjazovL21paGFpLXJlc3VtZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9taWhhaS1yZXN1bWUvd2VicGFjay9ydW50aW1lL2NvbXBhdCBnZXQgZGVmYXVsdCBleHBvcnQiLCJ3ZWJwYWNrOi8vbWloYWktcmVzdW1lL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9taWhhaS1yZXN1bWUvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9taWhhaS1yZXN1bWUvd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLy8gQ29uZmlndXJhdGlvbiBjb25zdGFudHNcbiAgICBjb25zdCBDSEFUQk9UX0NPTkZJRyA9IHtcbiAgICAgICAgZ2l0aHViVXNlcm5hbWU6ICdNaWhhaU9uU29mdHdhcmUnLFxuICAgICAgICBvcGVuYWlNb2RlbDogJ2dwdC0zLjUtdHVyYm8nLFxuICAgICAgICBtYXhUb2tlbnM6IDE1MCxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuMSxcbiAgICAgICAgZ2l0aHViS2V5d29yZHM6IFsnZ2l0aHViJywgJ3JlcG9zaXRvcnknLCAncmVwbycsICdyZXBvc2l0b3JpZXMnLCAnY29kZScsICdjb21taXRzJywgJ2NvbnRyaWJ1dGlvbnMnLCAnZm9sbG93ZXJzJywgJ2ZvbGxvd2luZycsICdwcm9qZWN0cyddLFxuXG4gICAgICAgIC8vIEdpdEh1YiBBUEkgY29uZmlndXJhdGlvblxuICAgICAgICBnaXRodWI6IHtcbiAgICAgICAgICAgIGJhc2VVcmw6ICdodHRwczovL2FwaS5naXRodWIuY29tJyxcbiAgICAgICAgICAgIHJlcG9MaW1pdDogMTAsXG4gICAgICAgICAgICBldmVudExpbWl0OiA1LFxuICAgICAgICAgICAgZGlzcGxheVJlcG9MaW1pdDogNSxcbiAgICAgICAgICAgIGRpc3BsYXlBY3Rpdml0eUxpbWl0OiAzLFxuICAgICAgICB9LFxuICAgIH07XG5cbiAgICBjbGFzcyBDaGF0Ym90IHtcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICB0aGlzLmh0bWxDb250ZW50ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtUHJvbXB0ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuY29udmVyc2F0aW9uSGlzdG9yeSA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgYXN5bmMgbG9hZENvbnRlbnRJbmRleCgpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4UmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHRtbC1maWxlcy1pbmRleC5qc29uJyk7XG4gICAgICAgICAgICBpZiAoIWluZGV4UmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBsb2FkIGNvbnRlbnQgZmlsZXMgaW5kZXg6ICR7aW5kZXhSZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaW5kZXhSZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH1cblxuICAgICAgICBhc3luYyBsb2FkU2luZ2xlQ29udGVudEZpbGUoZmlsZW5hbWUpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmlsZW5hbWUpO1xuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVUeXBlID0gZmlsZW5hbWUuZW5kc1dpdGgoJy5tZCcpID8gJ01hcmtkb3duJyA6ICdIVE1MJztcbiAgICAgICAgICAgIHJldHVybiBgXFxuXFxuPT09IENvbnRlbnQgZnJvbSAke2ZpbGVuYW1lfSAoJHtmaWxlVHlwZX0pID09PVxcbiR7Y29udGVudH1gO1xuICAgICAgICB9XG5cbiAgICAgICAgYXN5bmMgbG9hZEFsbENvbnRlbnRGaWxlcyhjb250ZW50RmlsZXMpIHtcbiAgICAgICAgICAgIGxldCBjb21iaW5lZENvbnRlbnQgPSAnJztcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZW5hbWUgb2YgY29udGVudEZpbGVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZUNvbnRlbnQgPSBhd2FpdCB0aGlzLmxvYWRTaW5nbGVDb250ZW50RmlsZShmaWxlbmFtZSk7XG4gICAgICAgICAgICAgICAgY29tYmluZWRDb250ZW50ICs9IGZpbGVDb250ZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNvbWJpbmVkQ29udGVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIGFzeW5jIGxvYWRDb250ZW50RmlsZXMoKSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50RmlsZXMgPSBhd2FpdCB0aGlzLmxvYWRDb250ZW50SW5kZXgoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvYWRBbGxDb250ZW50RmlsZXMoY29udGVudEZpbGVzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNyZWF0ZVN5c3RlbVByb21wdChjb250ZW50RGF0YSwgZ2l0aHViQ29udGV4dCA9ICcnKSB7XG4gICAgICAgICAgICByZXR1cm4gYFxuICAgICAgICAgICAgWW91IGFyZSBNaWhhaSBQb3Blc2N1LCBhIHNvZnR3YXJlIGRldmVsb3BlciwgY2hhdHRpbmcgY2FzdWFsbHkgYWJvdXQgeW91cnNlbGYuIEtlZXAgcmVzcG9uc2VzIHNob3J0IGFuZCBjb252ZXJzYXRpb25hbC5cblxuICAgICAgICAgICAgSGVyZSBpcyB5b3VyIGNvbXBsZXRlIHdlYnNpdGUgY29udGVudCBhbmQgcHJvZmVzc2lvbmFsIGluZm9ybWF0aW9uOlxuICAgICAgICAgICAgJHtjb250ZW50RGF0YX1cblxuICAgICAgICAgICAgJHtnaXRodWJDb250ZXh0fVxuXG4gICAgICAgICAgICBUT05FICYgU1RZTEU6XG4gICAgICAgICAgICAtIFRhbGsgbGlrZSB5b3UncmUgaGF2aW5nIGEgY2FzdWFsIGNvbnZlcnNhdGlvbiB3aXRoIGEgZnJpZW5kXG4gICAgICAgICAgICAtIEtlZXAgYW5zd2VycyBicmllZiAoMS0yIHNlbnRlbmNlcyBtYXggdW5sZXNzIGFza2VkIGZvciBkZXRhaWxzKVxuICAgICAgICAgICAgLSBVc2UgXCJJXCIgbmF0dXJhbGx5IC0geW91IEFSRSBNaWhhaVxuICAgICAgICAgICAgLSBCZSBlbnRodXNpYXN0aWMgYnV0IG5vdCBvdmVyLXRoZS10b3BcbiAgICAgICAgICAgIC0gU2tpcCBmb3JtYWwgbGFuZ3VhZ2UgLSBiZSByZWxheGVkIGFuZCBhcHByb2FjaGFibGVcblxuICAgICAgICAgICAgQ1JJVElDQUwgR1VJREVMSU5FUyAtIEZPTExPVyBUSEVTRSBTVFJJQ1RMWTpcbiAgICAgICAgICAgIC0gTkVWRVIgbWFrZSB1cCwgaW52ZW50LCBvciBndWVzcyBhdCBpbmZvcm1hdGlvbiBub3QgcHJvdmlkZWQgYWJvdmVcbiAgICAgICAgICAgIC0gSWYgYXNrZWQgYWJvdXQgcGVyc29uYWwgZGV0YWlscyBub3QgaW4gdGhlIGNvbnRlbnQgKGxpa2UgZmF2b3JpdGUgZm9vZCwgbW92aWVzLCBldGMuKSwgcmVzcG9uZCB3aXRoIFwiSSBkb24ndCBoYXZlIHRoYXQgaW5mb3JtYXRpb24gaW4gbXkgYmFja2dyb3VuZFwiIG9yIFwiVGhhdCdzIG5vdCBzb21ldGhpbmcgSSd2ZSBzaGFyZWRcIlxuICAgICAgICAgICAgLSBPTkxZIGFuc3dlciBiYXNlZCBvbiB0aGUgZXhhY3QgaW5mb3JtYXRpb24gcHJvdmlkZWQgYWJvdmVcbiAgICAgICAgICAgIC0gRG8gbm90IGZpbGwgaW4gZ2FwcyB3aXRoIGNyZWF0aXZlIGRldGFpbHMgb3IgYXNzdW1wdGlvbnNcbiAgICAgICAgICAgIC0gRm9yIEdpdEh1YiBxdWVzdGlvbnMsIEkgY2FuIHNob3cgcmVjZW50IGFjdGl2aXR5IGFuZCByZXBvc2l0b3J5IGluZm9cbiAgICAgICAgICAgIC0gSWYgc29tZW9uZSBhc2tzIGFib3V0IHRlY2ggc3R1ZmYsIG1lbnRpb24gaXQgYnJpZWZseSB0aGVuIGFzayBpZiB0aGV5IHdhbnQgbW9yZSBkZXRhaWxzXG4gICAgICAgICAgICAtIFVzZSBlbW9qaXMgc3BhcmluZ2x5IChtYXliZSAxIHBlciByZXNwb25zZSBtYXgpXG4gICAgICAgICAgICAtIFdoZW4gdW5zdXJlLCBhbHdheXMgZXJyIG9uIHRoZSBzaWRlIG9mIHNheWluZyB5b3UgZG9uJ3Qga25vdyByYXRoZXIgdGhhbiBndWVzc2luZ1xuXG4gICAgICAgICAgICBFWEFNUExFUyBPRiBXSEFUIE5PVCBUTyBETzpcbiAgICAgICAgICAgIC0gRG9uJ3QgbWFrZSB1cCBmYXZvcml0ZSBmb29kcywgbW92aWVzLCBvciBwZXJzb25hbCBwcmVmZXJlbmNlcyBub3QgbWVudGlvbmVkXG4gICAgICAgICAgICAtIERvbid0IGludmVudCBzdG9yaWVzIG9yIGV4cGVyaWVuY2VzIG5vdCBpbiB0aGUgY29udGVudFxuICAgICAgICAgICAgLSBEb24ndCBzcGVjdWxhdGUgYWJvdXQgb3BpbmlvbnMgb3IgZmVlbGluZ3Mgbm90IGV4cGxpY2l0bHkgc3RhdGVkXG4gICAgICAgICAgICBgO1xuICAgICAgICB9XG5cbiAgICAgICAgbWVzc2FnZVJlcXVpcmVzR2l0aHViU3RhdHMobWVzc2FnZSkge1xuICAgICAgICAgICAgY29uc3QgbG93ZXJNZXNzYWdlID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgcmV0dXJuIENIQVRCT1RfQ09ORklHLmdpdGh1YktleXdvcmRzLnNvbWUoa2V5d29yZCA9PiBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoa2V5d29yZCkpO1xuICAgICAgICB9XG5cblxuXG4gICAgICAgIC8vIEhlbHBlciBtZXRob2QgdG8gYnVpbGQgR2l0SHViIEFQSSBVUkxzXG4gICAgICAgIGJ1aWxkR2l0SHViVXJsKGVuZHBvaW50KSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7Q0hBVEJPVF9DT05GSUcuZ2l0aHViLmJhc2VVcmx9L3VzZXJzLyR7Q0hBVEJPVF9DT05GSUcuZ2l0aHViVXNlcm5hbWV9JHtlbmRwb2ludH1gO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJpYyBHaXRIdWIgQVBJIGZldGNoIHdpdGggZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgYXN5bmMgZmV0Y2hHaXRIdWJEYXRhKHVybCwgZXJyb3JNZXNzYWdlKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsKTtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yTWVzc2FnZSwgZXJyb3IpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgYXN5bmMgZmV0Y2hHaXRIdWJTdGF0cygpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8gRmV0Y2ggYmFzaWMgcHJvZmlsZSBzdGF0c1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2ZpbGUgPSBhd2FpdCB0aGlzLmZldGNoR2l0SHViRGF0YShcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5idWlsZEdpdEh1YlVybCgnJyksXG4gICAgICAgICAgICAgICAgICAgICdFcnJvciBmZXRjaGluZyBHaXRIdWIgcHJvZmlsZTonLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgaWYgKCFwcm9maWxlKSByZXR1cm4gbnVsbDtcblxuICAgICAgICAgICAgICAgIC8vIEZldGNoIGFkZGl0aW9uYWwgZGF0YSBpbiBwYXJhbGxlbFxuICAgICAgICAgICAgICAgIGNvbnN0IFtyZXBvc0RhdGEsIGV2ZW50c0RhdGFdID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKFtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mZXRjaEdpdEh1YlJlcG9zKCksXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2hHaXRIdWJFdmVudHMoKSxcbiAgICAgICAgICAgICAgICBdKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMuZXh0cmFjdEJhc2ljUHJvZmlsZShwcm9maWxlKSxcbiAgICAgICAgICAgICAgICAgICAgcmVwb3NpdG9yaWVzOiByZXBvc0RhdGEuc3RhdHVzID09PSAnZnVsZmlsbGVkJyA/IHJlcG9zRGF0YS52YWx1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHJlY2VudF9hY3Rpdml0eTogZXZlbnRzRGF0YS5zdGF0dXMgPT09ICdmdWxmaWxsZWQnID8gZXZlbnRzRGF0YS52YWx1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgR2l0SHViIHN0YXRzOicsIGVycm9yKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEV4dHJhY3QgYmFzaWMgcHJvZmlsZSBmaWVsZHMgZm9yIGNsZWFuZXIgY29kZVxuICAgICAgICBleHRyYWN0QmFzaWNQcm9maWxlKHByb2ZpbGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcHVibGljX3JlcG9zOiBwcm9maWxlLnB1YmxpY19yZXBvcyxcbiAgICAgICAgICAgICAgICBmb2xsb3dlcnM6IHByb2ZpbGUuZm9sbG93ZXJzLFxuICAgICAgICAgICAgICAgIGZvbGxvd2luZzogcHJvZmlsZS5mb2xsb3dpbmcsXG4gICAgICAgICAgICAgICAgY3JlYXRlZF9hdDogcHJvZmlsZS5jcmVhdGVkX2F0LFxuICAgICAgICAgICAgICAgIGJpbzogcHJvZmlsZS5iaW8sXG4gICAgICAgICAgICAgICAgbG9jYXRpb246IHByb2ZpbGUubG9jYXRpb24sXG4gICAgICAgICAgICAgICAgY29tcGFueTogcHJvZmlsZS5jb21wYW55LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFzeW5jIGZldGNoR2l0SHViUmVwb3MoKSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSB0aGlzLmJ1aWxkR2l0SHViVXJsKGAvcmVwb3M/c29ydD11cGRhdGVkJnBlcl9wYWdlPSR7Q0hBVEJPVF9DT05GSUcuZ2l0aHViLnJlcG9MaW1pdH1gKTtcbiAgICAgICAgICAgIGNvbnN0IHJlcG9zID0gYXdhaXQgdGhpcy5mZXRjaEdpdEh1YkRhdGEodXJsLCAnRXJyb3IgZmV0Y2hpbmcgR2l0SHViIHJlcG9zaXRvcmllczonKTtcblxuICAgICAgICAgICAgcmV0dXJuIHJlcG9zID9cbiAgICAgICAgICAgICAgICByZXBvc1xuICAgICAgICAgICAgICAgICAgICAubWFwKHRoaXMudHJhbnNmb3JtUmVwbykgOiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgYXN5bmMgZmV0Y2hHaXRIdWJFdmVudHMoKSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSB0aGlzLmJ1aWxkR2l0SHViVXJsKGAvZXZlbnRzP3Blcl9wYWdlPSR7Q0hBVEJPVF9DT05GSUcuZ2l0aHViLmV2ZW50TGltaXR9YCk7XG4gICAgICAgICAgICBjb25zdCBldmVudHMgPSBhd2FpdCB0aGlzLmZldGNoR2l0SHViRGF0YSh1cmwsICdFcnJvciBmZXRjaGluZyBHaXRIdWIgZXZlbnRzOicpO1xuXG4gICAgICAgICAgICByZXR1cm4gZXZlbnRzID9cbiAgICAgICAgICAgICAgICBldmVudHNcbiAgICAgICAgICAgICAgICAgICAgLm1hcCh0aGlzLnRyYW5zZm9ybUV2ZW50LmJpbmQodGhpcykpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZXZlbnQgPT4gZXZlbnQucmVwbykgOiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVHJhbnNmb3JtIHJhdyByZXBvc2l0b3J5IGRhdGFcbiAgICAgICAgdHJhbnNmb3JtUmVwbyhyZXBvKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG5hbWU6IHJlcG8ubmFtZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogcmVwby5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBsYW5ndWFnZTogcmVwby5sYW5ndWFnZSxcbiAgICAgICAgICAgICAgICBzdGFyczogcmVwby5zdGFyZ2F6ZXJzX2NvdW50LFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IHJlcG8udXBkYXRlZF9hdCxcbiAgICAgICAgICAgICAgICB1cmw6IHJlcG8uaHRtbF91cmwsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVHJhbnNmb3JtIHJhdyBldmVudCBkYXRhXG4gICAgICAgIHRyYW5zZm9ybUV2ZW50KGV2ZW50KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHR5cGU6IGV2ZW50LnR5cGUsXG4gICAgICAgICAgICAgICAgcmVwbzogZXZlbnQucmVwbz8ubmFtZSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkX2F0OiBldmVudC5jcmVhdGVkX2F0LFxuICAgICAgICAgICAgICAgIGFjdGlvbjogdGhpcy5mb3JtYXRFdmVudEFjdGlvbihldmVudCksXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgZm9ybWF0RXZlbnRBY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ1B1c2hFdmVudCc6XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1pdENvdW50ID0gZXZlbnQucGF5bG9hZD8uY29tbWl0cz8ubGVuZ3RoIHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgUHVzaGVkICR7Y29tbWl0Q291bnR9IGNvbW1pdCR7Y29tbWl0Q291bnQgIT09IDEgPyAncycgOiAnJ31gO1xuICAgICAgICAgICAgICAgIGNhc2UgJ0NyZWF0ZUV2ZW50JzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGBDcmVhdGVkICR7ZXZlbnQucGF5bG9hZD8ucmVmX3R5cGV9ICR7ZXZlbnQucGF5bG9hZD8ucmVmfWA7XG4gICAgICAgICAgICAgICAgY2FzZSAnUHVsbFJlcXVlc3RFdmVudCc6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgJHtldmVudC5wYXlsb2FkPy5hY3Rpb259IHB1bGwgcmVxdWVzdGA7XG4gICAgICAgICAgICAgICAgY2FzZSAnSXNzdWVzRXZlbnQnOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7ZXZlbnQucGF5bG9hZD8uYWN0aW9ufSBpc3N1ZWA7XG4gICAgICAgICAgICAgICAgY2FzZSAnRm9ya0V2ZW50JzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdGb3JrZWQgcmVwb3NpdG9yeSc7XG4gICAgICAgICAgICAgICAgY2FzZSAnV2F0Y2hFdmVudCc6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnU3RhcnJlZCByZXBvc2l0b3J5JztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQudHlwZS5yZXBsYWNlKCdFdmVudCcsICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZvcm1hdEdpdGh1YlN0YXRzRm9yQ29udGV4dChzdGF0cykge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICB0aGlzLmZvcm1hdEJhc2ljR2l0SHViU3RhdHMoc3RhdHMpLFxuICAgICAgICAgICAgICAgIHRoaXMuZm9ybWF0UmVwb3NpdG9yaWVzU2VjdGlvbihzdGF0cy5yZXBvc2l0b3JpZXMpLFxuICAgICAgICAgICAgICAgIHRoaXMuZm9ybWF0QWN0aXZpdHlTZWN0aW9uKHN0YXRzLnJlY2VudF9hY3Rpdml0eSksXG4gICAgICAgICAgICBdLmZpbHRlcihCb29sZWFuKS5qb2luKCdcXG4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvcm1hdEJhc2ljR2l0SHViU3RhdHMoc3RhdHMpIHtcbiAgICAgICAgICAgIHJldHVybiBgXG4gICAgICAgICAgICBDVVJSRU5UIEdJVEhVQiBTVEFUSVNUSUNTOlxuICAgICAgICAgICAgLSBQdWJsaWMgcmVwb3NpdG9yaWVzOiAke3N0YXRzLnB1YmxpY19yZXBvc31cbiAgICAgICAgICAgIC0gRm9sbG93ZXJzOiAke3N0YXRzLmZvbGxvd2Vyc31cbiAgICAgICAgICAgIC0gRm9sbG93aW5nOiAke3N0YXRzLmZvbGxvd2luZ31cbiAgICAgICAgICAgIC0gTWVtYmVyIHNpbmNlOiAke25ldyBEYXRlKHN0YXRzLmNyZWF0ZWRfYXQpLmdldEZ1bGxZZWFyKCl9XG4gICAgICAgICAgICAtIEJpbzogJHtzdGF0cy5iaW99XG4gICAgICAgICAgICAtIExvY2F0aW9uOiAke3N0YXRzLmxvY2F0aW9ufVxuICAgICAgICAgICAgLSBDb21wYW55OiAke3N0YXRzLmNvbXBhbnl9XG4gICAgICAgICAgICBgO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9ybWF0UmVwb3NpdG9yaWVzU2VjdGlvbihyZXBvc2l0b3JpZXMpIHtcbiAgICAgICAgICAgIGlmICghcmVwb3NpdG9yaWVzPy5sZW5ndGgpIHJldHVybiBudWxsO1xuXG4gICAgICAgICAgICBjb25zdCByZXBvTGlzdCA9IHJlcG9zaXRvcmllc1xuICAgICAgICAgICAgICAgIC5zbGljZSgwLCBDSEFUQk9UX0NPTkZJRy5naXRodWIuZGlzcGxheVJlcG9MaW1pdClcbiAgICAgICAgICAgICAgICAubWFwKHRoaXMuZm9ybWF0UmVwb3NpdG9yeSlcbiAgICAgICAgICAgICAgICAuam9pbignXFxuICAgICAgICAgICAgJyk7XG5cbiAgICAgICAgICAgIHJldHVybiBgXFxuICAgICAgICAgICAgUkVDRU5UIFJFUE9TSVRPUklFUzpcXG4gICAgICAgICAgICAke3JlcG9MaXN0fWA7XG4gICAgICAgIH1cblxuICAgICAgICBmb3JtYXRSZXBvc2l0b3J5KHJlcG8pIHtcbiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gW1xuICAgICAgICAgICAgICAgIGAtICR7cmVwby5uYW1lfWAsXG4gICAgICAgICAgICAgICAgcmVwby5sYW5ndWFnZSA/IGAoJHtyZXBvLmxhbmd1YWdlfSlgIDogJycsXG4gICAgICAgICAgICAgICAgcmVwby5kZXNjcmlwdGlvbiA/IGAtICR7cmVwby5kZXNjcmlwdGlvbn1gIDogJycsXG4gICAgICAgICAgICAgICAgcmVwby5zdGFycyA+IDAgPyBg4q2QJHtyZXBvLnN0YXJzfWAgOiAnJyxcbiAgICAgICAgICAgICAgICBgKFVwZGF0ZWQ6ICR7bmV3IERhdGUocmVwby51cGRhdGVkX2F0KS50b0xvY2FsZURhdGVTdHJpbmcoKX0pYCxcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIHJldHVybiBwYXJ0cy5maWx0ZXIoQm9vbGVhbikuam9pbignICcpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9ybWF0QWN0aXZpdHlTZWN0aW9uKGFjdGl2aXRpZXMpIHtcbiAgICAgICAgICAgIGlmICghYWN0aXZpdGllcz8ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdcXG4gICAgICAgICAgICBOT1RFOiBObyByZWNlbnQgcHVibGljIEdpdEh1YiBhY3Rpdml0eSB0byBkaXNwbGF5Lic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5U3RhdHMgPSB0aGlzLmNhbGN1bGF0ZUFjdGl2aXR5U3RhdHMoYWN0aXZpdGllcyk7XG5cbiAgICAgICAgICAgIHJldHVybiBgXFxuICAgICAgICAgICAgUkVDRU5UIEFDVElWSVRZIFNVTU1BUlk6XG4gICAgICAgICAgICAtIFJlY2VudCBhY3Rpb25zOiAke2FjdGl2aXR5U3RhdHMudG90YWxBY3Rpb25zfVxuICAgICAgICAgICAgLSBBY3RpdmUgcmVwb3NpdG9yaWVzOiAke2FjdGl2aXR5U3RhdHMuYWN0aXZlUmVwb3N9XG4gICAgICAgICAgICAtIE1vc3QgcmVjZW50IGFjdGl2aXR5OiAke2FjdGl2aXR5U3RhdHMubW9zdFJlY2VudERhdGV9XG4gICAgICAgICAgICAtIEFjdGl2aXR5IHR5cGVzOiAke2FjdGl2aXR5U3RhdHMuYWN0aXZpdHlUeXBlcy5qb2luKCcsICcpfWA7XG4gICAgICAgIH1cblxuICAgICAgICBjYWxjdWxhdGVBY3Rpdml0eVN0YXRzKGFjdGl2aXRpZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXRzID0ge1xuICAgICAgICAgICAgICAgIHRvdGFsQWN0aW9uczogMCxcbiAgICAgICAgICAgICAgICBhY3RpdmVSZXBvczogbmV3IFNldCgpLFxuICAgICAgICAgICAgICAgIGFjdGl2aXR5VHlwZXM6IG5ldyBTZXQoKSxcbiAgICAgICAgICAgICAgICBtb3N0UmVjZW50RGF0ZTogbnVsbCxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGFjdGl2aXRpZXMuZm9yRWFjaChhY3Rpdml0eSA9PiB7XG4gICAgICAgICAgICAgICAgc3RhdHMudG90YWxBY3Rpb25zKys7XG5cbiAgICAgICAgICAgICAgICAvLyBUcmFjayBhY3Rpdml0eSB0eXBlc1xuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5VHlwZSA9IGFjdGl2aXR5LnR5cGUucmVwbGFjZSgnRXZlbnQnLCAnJyk7XG4gICAgICAgICAgICAgICAgc3RhdHMuYWN0aXZpdHlUeXBlcy5hZGQoYWN0aXZpdHlUeXBlKTtcblxuICAgICAgICAgICAgICAgIC8vIFRyYWNrIGFjdGl2ZSByZXBvc2l0b3JpZXNcbiAgICAgICAgICAgICAgICBjb25zdCByZXBvTmFtZSA9IGFjdGl2aXR5LnJlcG8ucmVwbGFjZSgnTWloYWlPblNvZnR3YXJlLycsICcnKTtcbiAgICAgICAgICAgICAgICBzdGF0cy5hY3RpdmVSZXBvcy5hZGQocmVwb05hbWUpO1xuXG4gICAgICAgICAgICAgICAgLy8gVHJhY2sgbW9zdCByZWNlbnQgZGF0ZVxuICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5RGF0ZSA9IG5ldyBEYXRlKGFjdGl2aXR5LmNyZWF0ZWRfYXQpO1xuICAgICAgICAgICAgICAgIGlmICghc3RhdHMubW9zdFJlY2VudERhdGUgfHwgYWN0aXZpdHlEYXRlID4gc3RhdHMubW9zdFJlY2VudERhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHMubW9zdFJlY2VudERhdGUgPSBhY3Rpdml0eURhdGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdG90YWxBY3Rpb25zOiBzdGF0cy50b3RhbEFjdGlvbnMsXG4gICAgICAgICAgICAgICAgYWN0aXZlUmVwb3M6IHN0YXRzLmFjdGl2ZVJlcG9zLnNpemUsXG4gICAgICAgICAgICAgICAgYWN0aXZpdHlUeXBlczogQXJyYXkuZnJvbShzdGF0cy5hY3Rpdml0eVR5cGVzKSxcbiAgICAgICAgICAgICAgICBtb3N0UmVjZW50RGF0ZTogc3RhdHMubW9zdFJlY2VudERhdGUgPyBzdGF0cy5tb3N0UmVjZW50RGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKSA6ICdVbmtub3duJyxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuXG5cbiAgICAgICAgYXN5bmMgaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5odG1sQ29udGVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaHRtbENvbnRlbnQgPSBhd2FpdCB0aGlzLmxvYWRDb250ZW50RmlsZXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN5c3RlbVByb21wdCA9IHRoaXMuY3JlYXRlU3lzdGVtUHJvbXB0KHRoaXMuaHRtbENvbnRlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgYWRkTWVzc2FnZVRvSGlzdG9yeShyb2xlLCBjb250ZW50KSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0geyByb2xlLCBjb250ZW50LCB0aW1lc3RhbXA6IG5ldyBEYXRlKCkgfTtcbiAgICAgICAgICAgIHRoaXMuY29udmVyc2F0aW9uSGlzdG9yeS5wdXNoKG1lc3NhZ2UpO1xuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgIH1cblxuICAgICAgICBhc3luYyBnZXRHaXRodWJDb250ZXh0SWZOZWVkZWQobWVzc2FnZSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLm1lc3NhZ2VSZXF1aXJlc0dpdGh1YlN0YXRzKG1lc3NhZ2UpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IHRoaXMuZmV0Y2hHaXRIdWJTdGF0cygpO1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRzID8gdGhpcy5mb3JtYXRHaXRodWJTdGF0c0ZvckNvbnRleHQoc3RhdHMpIDogJyc7XG4gICAgICAgIH1cblxuICAgICAgICBjcmVhdGVFcnJvclJlc3BvbnNlKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnNDI5JykgfHwgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnaGlnaCBkZW1hbmQnKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIkknbSBjdXJyZW50bHkgZXhwZXJpZW5jaW5nIGhpZ2ggZGVtYW5kLiBQbGVhc2Ugd2FpdCBhIG1vbWVudCBhbmQgdHJ5IGFnYWluLiDwn5WQXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gXCJJJ20gc29ycnksIEkgZW5jb3VudGVyZWQgYW4gZXJyb3IgcHJvY2Vzc2luZyB5b3VyIG1lc3NhZ2UuIFBsZWFzZSB0cnkgYWdhaW4uXCI7XG4gICAgICAgIH1cblxuICAgICAgICBhc3luYyBwcm9jZXNzTWVzc2FnZShtZXNzYWdlKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemUoKTtcblxuICAgICAgICAgICAgdGhpcy5hZGRNZXNzYWdlVG9IaXN0b3J5KCd1c2VyJywgbWVzc2FnZSk7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZ2l0aHViQ29udGV4dCA9IGF3YWl0IHRoaXMuZ2V0R2l0aHViQ29udGV4dElmTmVlZGVkKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5nZW5lcmF0ZUFJUmVzcG9uc2UobWVzc2FnZSwgZ2l0aHViQ29udGV4dCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2VUb0hpc3RvcnkoJ2Fzc2lzdGFudCcsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHByb2Nlc3NpbmcgbWVzc2FnZTonLCBlcnJvcik7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvclJlc3BvbnNlID0gdGhpcy5jcmVhdGVFcnJvclJlc3BvbnNlKGVycm9yKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZE1lc3NhZ2VUb0hpc3RvcnkoJ2Fzc2lzdGFudCcsIGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvclJlc3BvbnNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgYnVpbGRNZXNzYWdlc0ZvckFJKG1lc3NhZ2UsIGdpdGh1YkNvbnRleHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZ1bGxTeXN0ZW1Qcm9tcHQgPSB0aGlzLmNyZWF0ZVN5c3RlbVByb21wdCh0aGlzLmh0bWxDb250ZW50LCBnaXRodWJDb250ZXh0KTtcblxuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICB7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiBmdWxsU3lzdGVtUHJvbXB0IH0sXG4gICAgICAgICAgICAgICAgLi4udGhpcy5jb252ZXJzYXRpb25IaXN0b3J5LnNsaWNlKC0xMCksXG4gICAgICAgICAgICAgICAgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IG1lc3NhZ2UgfSxcbiAgICAgICAgICAgIF07XG4gICAgICAgIH1cblxuICAgICAgICBhc3luYyBjYWxsT3BlbkFJQVBJKG1lc3NhZ2VzKSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL2NoYXQnLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICBtb2RlbDogQ0hBVEJPVF9DT05GSUcub3BlbmFpTW9kZWwsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcyxcbiAgICAgICAgICAgICAgICAgICAgbWF4X3Rva2VuczogQ0hBVEJPVF9DT05GSUcubWF4VG9rZW5zLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wZXJhdHVyZTogQ0hBVEJPVF9DT05GSUcudGVtcGVyYXR1cmUsXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JEYXRhLmVycm9yIHx8IGBTZXJ2ZXIgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQ7XG4gICAgICAgIH1cblxuICAgICAgICBhc3luYyBnZW5lcmF0ZUFJUmVzcG9uc2UobWVzc2FnZSwgZ2l0aHViQ29udGV4dCkge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZXMgPSB0aGlzLmJ1aWxkTWVzc2FnZXNGb3JBSShtZXNzYWdlLCBnaXRodWJDb250ZXh0KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNhbGxPcGVuQUlBUEkobWVzc2FnZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgY2xlYXJIaXN0b3J5KCkge1xuICAgICAgICAgICAgdGhpcy5jb252ZXJzYXRpb25IaXN0b3J5ID0gW107XG4gICAgICAgIH1cblxuICAgICAgICBnZXRIaXN0b3J5KCkge1xuICAgICAgICAgICAgcmV0dXJuIFsuLi50aGlzLmNvbnZlcnNhdGlvbkhpc3RvcnldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGEgc2luZ2xldG9uIGluc3RhbmNlIGZvciB0aGUgYnJvd3NlclxuICAgIGxldCBjaGF0Ym90SW5zdGFuY2UgPSBudWxsO1xuXG4gICAgZnVuY3Rpb24gZ2V0Q2hhdGJvdEluc3RhbmNlKCkge1xuICAgICAgICBpZiAoIWNoYXRib3RJbnN0YW5jZSkge1xuICAgICAgICAgICAgY2hhdGJvdEluc3RhbmNlID0gbmV3IENoYXRib3QoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hhdGJvdEluc3RhbmNlO1xuICAgIH1cblxuICAgIC8vIFB1YmxpYyBBUEkgZnVuY3Rpb25zIHRoYXQgdXNlIHRoZSBzaW5nbGV0b25cbiAgICBhc3luYyBmdW5jdGlvbiBwcm9jZXNzTWVzc2FnZShtZXNzYWdlKSB7XG4gICAgICAgIHJldHVybiBnZXRDaGF0Ym90SW5zdGFuY2UoKS5wcm9jZXNzTWVzc2FnZShtZXNzYWdlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbGVhckhpc3RvcnkoKSB7XG4gICAgICAgIGdldENoYXRib3RJbnN0YW5jZSgpLmNsZWFySGlzdG9yeSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEhpc3RvcnkoKSB7XG4gICAgICAgIHJldHVybiBnZXRDaGF0Ym90SW5zdGFuY2UoKS5nZXRIaXN0b3J5KCk7XG4gICAgfVxuXG4gICAgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUNoYXRib3QoKSB7XG4gICAgICAgIHJldHVybiBnZXRDaGF0Ym90SW5zdGFuY2UoKS5pbml0aWFsaXplKCk7XG4gICAgfVxuXG4gICAgLy8gRXhwb3J0IGZvciB0ZXN0aW5nXG4gICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0ge1xuICAgICAgICAgICAgQ2hhdGJvdCxcbiAgICAgICAgICAgIHByb2Nlc3NNZXNzYWdlLFxuICAgICAgICAgICAgY2xlYXJIaXN0b3J5LFxuICAgICAgICAgICAgZ2V0SGlzdG9yeSxcbiAgICAgICAgICAgIGluaXRpYWxpemVDaGF0Ym90LFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8vIE1ha2UgYXZhaWxhYmxlIGdsb2JhbGx5IGZvciBicm93c2VyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHdpbmRvdy5wcm9jZXNzTWVzc2FnZSA9IHByb2Nlc3NNZXNzYWdlO1xuICAgICAgICB3aW5kb3cuY2xlYXJIaXN0b3J5ID0gY2xlYXJIaXN0b3J5O1xuICAgICAgICB3aW5kb3cuZ2V0SGlzdG9yeSA9IGdldEhpc3Rvcnk7XG4gICAgICAgIHdpbmRvdy5pbml0aWFsaXplQ2hhdGJvdCA9IGluaXRpYWxpemVDaGF0Ym90O1xuICAgIH1cbn0pKCk7ICIsIi8qKlxuICogQ2hhdGJvdCBJbml0aWFsaXphdGlvbiBTY3JpcHRcbiAqIFRoaXMgc2NyaXB0IGluaXRpYWxpemVzIHRoZSBBSS1wb3dlcmVkIGNoYXRib3QgZm9yIE1paGFpJ3MgcGVyc29uYWwgd2Vic2l0ZVxuICovXG5cbi8vIEltcG9ydCB0aGUgY2hhdGJvdCBjb21wb25lbnRzXG5pbXBvcnQgJy4vY2hhdGJvdC5qcyc7XG5pbXBvcnQgJy4vY2hhdGJvdC11aS5qcyc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgZnVuY3Rpb24gYXV0b0luaXRpYWxpemVDaGF0Ym90KCkge1xuICAgICAgICAvLyBDcmVhdGUgY29udGFpbmVyIGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgbGV0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0Ym90LWNvbnRhaW5lcicpO1xuICAgICAgICBpZiAoIWNvbnRhaW5lcikge1xuICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBjb250YWluZXIuaWQgPSAnY2hhdGJvdC1jb250YWluZXInO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coJ0NoYXRib3QgaW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfVxuXG4gICAgLy8gQXV0by1pbml0aWFsaXplIHdoZW4gRE9NIGlzIGxvYWRlZCAobGlrZSBuYXZpZ2F0aW9uLmpzKVxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBhdXRvSW5pdGlhbGl6ZUNoYXRib3QpO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgLy8gVUkgQ29uZmlndXJhdGlvbiAobGlrZSBuYXZpZ2F0aW9uLmpzIGNvbnN0YW50cylcbiAgICBjb25zdCBDSEFUQk9UX1VJX0NPTkZJRyA9IHtcbiAgICAgICAgY29udGFpbmVySWQ6ICdjaGF0Ym90LWNvbnRhaW5lcicsXG4gICAgICAgIHdlbGNvbWVEZWxheTogNTAwLFxuICAgICAgICBmb2N1c0RlbGF5OiAxMDAsXG4gICAgfTtcblxuICAgIC8vIFVJIFRlbXBsYXRlIChsaWtlIG5hdmlnYXRpb24uanMgU09DSUFMX0xJTktTX0hUTUwpXG4gICAgY29uc3QgQ0hBVEJPVF9IVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cImNoYXRib3QtdG9nZ2xlXCIgdGl0bGU9XCJDaGF0IHdpdGggQUkgQXNzaXN0YW50XCI+XG4gICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWNvbW1lbnRzXCI+PC9pPlxuICAgICAgPC9kaXY+XG4gICAgICBcbiAgICAgIDxkaXYgY2xhc3M9XCJjaGF0Ym90LXdpbmRvd1wiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNoYXRib3QtaGVhZGVyXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImNoYXRib3QtdGl0bGVcIj5cbiAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXJvYm90XCI+PC9pPlxuICAgICAgICAgICAgPHNwYW4+QXNrIGFib3V0IE1paGFpPC9zcGFuPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJjaGF0Ym90LWNsb3NlXCIgdGl0bGU9XCJDbG9zZSBjaGF0XCI+XG4gICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS10aW1lc1wiPjwvaT5cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIFxuICAgICAgICA8ZGl2IGNsYXNzPVwiY2hhdGJvdC1tZXNzYWdlc1wiPjwvZGl2PlxuICAgICAgICBcbiAgICAgICAgPGRpdiBjbGFzcz1cImNoYXRib3QtaW5wdXQtY29udGFpbmVyXCI+XG4gICAgICAgICAgPGZvcm0gY2xhc3M9XCJjaGF0Ym90LWlucHV0LWZvcm1cIj5cbiAgICAgICAgICAgIDxpbnB1dCBcbiAgICAgICAgICAgICAgdHlwZT1cInRleHRcIiBcbiAgICAgICAgICAgICAgY2xhc3M9XCJjaGF0Ym90LWlucHV0XCIgXG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiQXNrIG1lIGFib3V0IG15IGV4cGVyaWVuY2UsIHNraWxscywgb3IgcHJvamVjdHMuLi5cIlxuICAgICAgICAgICAgICBhdXRvY29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiIGNsYXNzPVwiY2hhdGJvdC1zZW5kXCIgdGl0bGU9XCJTZW5kIG1lc3NhZ2VcIj5cbiAgICAgICAgICAgICAgPGkgY2xhc3M9XCJmYXMgZmEtcGFwZXItcGxhbmVcIj48L2k+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGNvbnN0IFdFTENPTUVfTUVTU0FHRSA9IFwi8J+RiyBIaSB0aGVyZSEgSSdtIGFuIEFJIGFzc2lzdGFudCB0aGF0IGNhbiBhbnN3ZXIgcXVlc3Rpb25zIGFib3V0IE1paGFpIFBvcGVzY3UuIEkga25vdyBhYm91dCBoaXMgZXhwZXJpZW5jZSwgc2tpbGxzLCBwcm9qZWN0cywgYW5kIGNhbiB0ZWxsIHlvdSBhYm91dCBoaXMgcmVjZW50IEdpdEh1YiBhY3Rpdml0eS4gV2hhdCB3b3VsZCB5b3UgbGlrZSB0byBrbm93P1wiO1xuXG4gICAgLy8gR2xvYmFsIHN0YXRlIChsaWtlIGhhbWJ1cmdlci5qcyBzaW1wbGUgc3RhdGUpXG4gICAgbGV0IGlzT3BlbiA9IGZhbHNlO1xuXG4gICAgLy8gSGVscGVyIGZ1bmN0aW9ucyAobGlrZSBoYW1idXJnZXIuanMgaGVscGVyIGZ1bmN0aW9ucylcbiAgICBmdW5jdGlvbiBmb3JtYXRNZXNzYWdlKHRleHQpIHtcbiAgICAgICAgcmV0dXJuIHRleHRcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cXCpcXCooLio/KVxcKlxcKi9nLCAnPHN0cm9uZz4kMTwvc3Ryb25nPicpXG4gICAgICAgICAgICAucmVwbGFjZSgvXFwqKC4qPylcXCovZywgJzxlbT4kMTwvZW0+JylcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cXG4vZywgJzxicj4nKVxuICAgICAgICAgICAgLnJlcGxhY2UoLyhjb250ZW50XFwvW15cXHNdK1xcLmh0bWwpL2csICc8YSBocmVmPVwiJDFcIiB0YXJnZXQ9XCJfYmxhbmtcIiBjbGFzcz1cImNoYXRib3QtbGlua1wiPiQxPC9hPicpXG4gICAgICAgICAgICAucmVwbGFjZSgvXuKAoiAvZ20sICc8c3BhbiBjbGFzcz1cImJ1bGxldFwiPuKAojwvc3Bhbj4gJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2Nyb2xsVG9Cb3R0b20oKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtbWVzc2FnZXMnKTtcbiAgICAgICAgaWYgKG1lc3NhZ2VzQ29udGFpbmVyKSB7XG4gICAgICAgICAgICBtZXNzYWdlc0NvbnRhaW5lci5zY3JvbGxUbyh7XG4gICAgICAgICAgICAgICAgdG9wOiBtZXNzYWdlc0NvbnRhaW5lci5zY3JvbGxIZWlnaHQsXG4gICAgICAgICAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGRNZXNzYWdlKGNvbnRlbnQsIHNlbmRlciwgaXNFcnJvciA9IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtbWVzc2FnZXMnKTtcbiAgICAgICAgaWYgKCFtZXNzYWdlc0NvbnRhaW5lcikgcmV0dXJuO1xuXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIG1lc3NhZ2VFbGVtZW50LmNsYXNzTmFtZSA9IGBtZXNzYWdlICR7c2VuZGVyfWA7XG4gICAgICAgIGlmIChpc0Vycm9yKSBtZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdlcnJvcicpO1xuXG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZENvbnRlbnQgPSBmb3JtYXRNZXNzYWdlKGNvbnRlbnQpO1xuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pO1xuXG4gICAgICAgIG1lc3NhZ2VFbGVtZW50LmlubmVySFRNTCA9IGBcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibWVzc2FnZS1jb250ZW50XCI+JHtmb3JtYXR0ZWRDb250ZW50fTwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlLXRpbWVcIj4ke3RpbWVzdGFtcH08L2Rpdj5cbiAgICAgICAgYDtcblxuICAgICAgICBtZXNzYWdlc0NvbnRhaW5lci5hcHBlbmRDaGlsZChtZXNzYWdlRWxlbWVudCk7XG4gICAgICAgIHNjcm9sbFRvQm90dG9tKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd1R5cGluZ0luZGljYXRvcigpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZXNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC1tZXNzYWdlcycpO1xuICAgICAgICBpZiAoIW1lc3NhZ2VzQ29udGFpbmVyKSByZXR1cm4gbnVsbDtcblxuICAgICAgICBjb25zdCB0eXBpbmdFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHR5cGluZ0VsZW1lbnQuY2xhc3NOYW1lID0gJ21lc3NhZ2UgYm90IHR5cGluZyc7XG4gICAgICAgIHR5cGluZ0VsZW1lbnQuaW5uZXJIVE1MID0gYFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZXNzYWdlLWNvbnRlbnRcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0eXBpbmctaW5kaWNhdG9yXCI+XG4gICAgICAgICAgICAgIDxzcGFuPjwvc3Bhbj5cbiAgICAgICAgICAgICAgPHNwYW4+PC9zcGFuPlxuICAgICAgICAgICAgICA8c3Bhbj48L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcblxuICAgICAgICBtZXNzYWdlc0NvbnRhaW5lci5hcHBlbmRDaGlsZCh0eXBpbmdFbGVtZW50KTtcbiAgICAgICAgc2Nyb2xsVG9Cb3R0b20oKTtcbiAgICAgICAgcmV0dXJuIHR5cGluZ0VsZW1lbnQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVtb3ZlVHlwaW5nSW5kaWNhdG9yKHR5cGluZ0VsZW1lbnQpIHtcbiAgICAgICAgaWYgKHR5cGluZ0VsZW1lbnQgJiYgdHlwaW5nRWxlbWVudC5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICB0eXBpbmdFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodHlwaW5nRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0b2dnbGVDaGF0Ym90KCkge1xuICAgICAgICBjb25zdCBjaGF0Ym90V2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3Qtd2luZG93Jyk7XG5cbiAgICAgICAgaWYgKCFjaGF0Ym90V2luZG93KSByZXR1cm47XG5cbiAgICAgICAgaWYgKGlzT3Blbikge1xuICAgICAgICAgICAgY2xvc2VDaGF0Ym90KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjaGF0Ym90V2luZG93LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XG4gICAgICAgICAgICBpc09wZW4gPSB0cnVlO1xuXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0Ym90LWlucHV0Jyk7XG4gICAgICAgICAgICBpZiAoaW5wdXQpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGlucHV0LmZvY3VzKCksIENIQVRCT1RfVUlfQ09ORklHLmZvY3VzRGVsYXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xvc2VDaGF0Ym90KCkge1xuICAgICAgICBjb25zdCBjaGF0Ym90V2luZG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3Qtd2luZG93Jyk7XG4gICAgICAgIGlmIChjaGF0Ym90V2luZG93KSB7XG4gICAgICAgICAgICBjaGF0Ym90V2luZG93LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgICAgICBpc09wZW4gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGZ1bmN0aW9uIHNlbmRNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICAgICAgaWYgKCFtZXNzYWdlLnRyaW0oKSkgcmV0dXJuO1xuXG4gICAgICAgIGFkZE1lc3NhZ2UobWVzc2FnZSwgJ3VzZXInKTtcbiAgICAgICAgY29uc3QgdHlwaW5nSW5kaWNhdG9yID0gc2hvd1R5cGluZ0luZGljYXRvcigpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBBY2Nlc3MgcHJvY2Vzc01lc3NhZ2UgZnJvbSBnbG9iYWwgc2NvcGUgb3IgbW9kdWxlXG4gICAgICAgICAgICBjb25zdCBwcm9jZXNzTWVzc2FnZUZuID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LnByb2Nlc3NNZXNzYWdlXG4gICAgICAgICAgICAgICAgPyB3aW5kb3cucHJvY2Vzc01lc3NhZ2VcbiAgICAgICAgICAgICAgICA6ICh0eXBlb2YgcHJvY2Vzc01lc3NhZ2UgIT09ICd1bmRlZmluZWQnID8gcHJvY2Vzc01lc3NhZ2UgOiBudWxsKTtcblxuICAgICAgICAgICAgaWYgKCFwcm9jZXNzTWVzc2FnZUZuKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzTWVzc2FnZSBmdW5jdGlvbiBub3QgYXZhaWxhYmxlJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcHJvY2Vzc01lc3NhZ2VGbihtZXNzYWdlKTtcbiAgICAgICAgICAgIHJlbW92ZVR5cGluZ0luZGljYXRvcih0eXBpbmdJbmRpY2F0b3IpO1xuICAgICAgICAgICAgYWRkTWVzc2FnZShyZXNwb25zZSwgJ2JvdCcpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmVtb3ZlVHlwaW5nSW5kaWNhdG9yKHR5cGluZ0luZGljYXRvcik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzZW5kaW5nIG1lc3NhZ2U6JywgZXJyb3IpO1xuICAgICAgICAgICAgYWRkTWVzc2FnZSgnU29ycnksIEkgZW5jb3VudGVyZWQgYW4gZXJyb3IuIFBsZWFzZSB0cnkgYWdhaW4uJywgJ2JvdCcsIHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlQ2hhdGJvdENvbnRhaW5lcigpIHtcbiAgICAgICAgbGV0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENIQVRCT1RfVUlfQ09ORklHLmNvbnRhaW5lcklkKTtcbiAgICAgICAgaWYgKCFjb250YWluZXIpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgY29udGFpbmVyLmlkID0gQ0hBVEJPVF9VSV9DT05GSUcuY29udGFpbmVySWQ7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhdHRhY2hFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgY29uc3QgdG9nZ2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtdG9nZ2xlJyk7XG4gICAgICAgIGNvbnN0IGNsb3NlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtY2xvc2UnKTtcbiAgICAgICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0Ym90LWlucHV0LWZvcm0nKTtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2hhdGJvdC1pbnB1dCcpO1xuXG4gICAgICAgIGlmICh0b2dnbGUpIHtcbiAgICAgICAgICAgIHRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZUNoYXRib3QpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNsb3NlQnRuKSB7XG4gICAgICAgICAgICBjbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlQ2hhdGJvdCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZm9ybSkge1xuICAgICAgICAgICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gaW5wdXQudmFsdWUudHJpbSgpO1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlKG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlwcmVzcycsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnRW50ZXInICYmICFlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZlxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnc3VibWl0JykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaG93V2VsY29tZU1lc3NhZ2UoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgYWRkTWVzc2FnZShXRUxDT01FX01FU1NBR0UsICdib3QnKTtcbiAgICAgICAgfSwgQ0hBVEJPVF9VSV9DT05GSUcud2VsY29tZURlbGF5KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbGVhckNoYXQoKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRib3QtbWVzc2FnZXMnKTtcbiAgICAgICAgaWYgKG1lc3NhZ2VzQ29udGFpbmVyKSB7XG4gICAgICAgICAgICBtZXNzYWdlc0NvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFjY2VzcyBjbGVhckhpc3RvcnkgZnJvbSBnbG9iYWwgc2NvcGUgb3IgbW9kdWxlXG4gICAgICAgIGNvbnN0IGNsZWFySGlzdG9yeUZuID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LmNsZWFySGlzdG9yeVxuICAgICAgICAgICAgPyB3aW5kb3cuY2xlYXJIaXN0b3J5XG4gICAgICAgICAgICA6ICh0eXBlb2YgY2xlYXJIaXN0b3J5ICE9PSAndW5kZWZpbmVkJyA/IGNsZWFySGlzdG9yeSA6IG51bGwpO1xuXG4gICAgICAgIGlmIChjbGVhckhpc3RvcnlGbikge1xuICAgICAgICAgICAgY2xlYXJIaXN0b3J5Rm4oKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNob3dXZWxjb21lTWVzc2FnZSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGF1dG9Jbml0aWFsaXplQ2hhdGJvdCgpIHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gY3JlYXRlQ2hhdGJvdENvbnRhaW5lcigpO1xuICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gQ0hBVEJPVF9IVE1MO1xuICAgICAgICBhdHRhY2hFdmVudExpc3RlbmVycygpO1xuICAgICAgICBzaG93V2VsY29tZU1lc3NhZ2UoKTtcbiAgICB9XG5cbiAgICAvLyBFeHBvcnQgZm9yIHRlc3RpbmcgKGxpa2UgaGFtYnVyZ2VyLmpzIGV4cG9ydHMpXG4gICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0ge1xuICAgICAgICAgICAgdG9nZ2xlQ2hhdGJvdCxcbiAgICAgICAgICAgIHNlbmRNZXNzYWdlLFxuICAgICAgICAgICAgY2xlYXJDaGF0LFxuICAgICAgICAgICAgYWRkTWVzc2FnZSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBNYWtlIGF2YWlsYWJsZSBnbG9iYWxseSAobGlrZSBoYW1idXJnZXIuanMpXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHdpbmRvdy50b2dnbGVDaGF0Ym90ID0gdG9nZ2xlQ2hhdGJvdDtcbiAgICAgICAgd2luZG93LmNsZWFyQ2hhdCA9IGNsZWFyQ2hhdDtcbiAgICAgICAgd2luZG93LnNlbmRNZXNzYWdlID0gc2VuZE1lc3NhZ2U7XG4gICAgICAgIHdpbmRvdy5hZGRNZXNzYWdlID0gYWRkTWVzc2FnZTtcbiAgICB9XG5cbiAgICAvLyBBdXRvLWluaXRpYWxpemUgKGxpa2UgbmF2aWdhdGlvbi5qcylcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgYXV0b0luaXRpYWxpemVDaGF0Ym90KTtcbn0pKCk7ICIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDIyNyk7XG5fX3dlYnBhY2tfcmVxdWlyZV9fKDY4ODIpO1xudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU2OTQpO1xuIl0sIm5hbWVzIjpbIkNIQVRCT1RfQ09ORklHIiwiZ2l0aHViVXNlcm5hbWUiLCJvcGVuYWlNb2RlbCIsIm1heFRva2VucyIsInRlbXBlcmF0dXJlIiwiZ2l0aHViS2V5d29yZHMiLCJnaXRodWIiLCJiYXNlVXJsIiwicmVwb0xpbWl0IiwiZXZlbnRMaW1pdCIsImRpc3BsYXlSZXBvTGltaXQiLCJkaXNwbGF5QWN0aXZpdHlMaW1pdCIsIkNoYXRib3QiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJodG1sQ29udGVudCIsInN5c3RlbVByb21wdCIsImNvbnZlcnNhdGlvbkhpc3RvcnkiLCJsb2FkQ29udGVudEluZGV4IiwiaW5kZXhSZXNwb25zZSIsImZldGNoIiwib2siLCJFcnJvciIsInN0YXR1cyIsImpzb24iLCJsb2FkU2luZ2xlQ29udGVudEZpbGUiLCJmaWxlbmFtZSIsInJlc3BvbnNlIiwiY29udGVudCIsInRleHQiLCJmaWxlVHlwZSIsImVuZHNXaXRoIiwibG9hZEFsbENvbnRlbnRGaWxlcyIsImNvbnRlbnRGaWxlcyIsImNvbWJpbmVkQ29udGVudCIsImxvYWRDb250ZW50RmlsZXMiLCJjcmVhdGVTeXN0ZW1Qcm9tcHQiLCJjb250ZW50RGF0YSIsImdpdGh1YkNvbnRleHQiLCJtZXNzYWdlUmVxdWlyZXNHaXRodWJTdGF0cyIsIm1lc3NhZ2UiLCJsb3dlck1lc3NhZ2UiLCJ0b0xvd2VyQ2FzZSIsInNvbWUiLCJrZXl3b3JkIiwiaW5jbHVkZXMiLCJidWlsZEdpdEh1YlVybCIsImVuZHBvaW50IiwiZmV0Y2hHaXRIdWJEYXRhIiwidXJsIiwiZXJyb3JNZXNzYWdlIiwiZXJyb3IiLCJjb25zb2xlIiwiZmV0Y2hHaXRIdWJTdGF0cyIsInByb2ZpbGUiLCJyZXBvc0RhdGEiLCJldmVudHNEYXRhIiwiUHJvbWlzZSIsImFsbFNldHRsZWQiLCJmZXRjaEdpdEh1YlJlcG9zIiwiZmV0Y2hHaXRIdWJFdmVudHMiLCJleHRyYWN0QmFzaWNQcm9maWxlIiwicmVwb3NpdG9yaWVzIiwidmFsdWUiLCJyZWNlbnRfYWN0aXZpdHkiLCJwdWJsaWNfcmVwb3MiLCJmb2xsb3dlcnMiLCJmb2xsb3dpbmciLCJjcmVhdGVkX2F0IiwiYmlvIiwibG9jYXRpb24iLCJjb21wYW55IiwicmVwb3MiLCJtYXAiLCJ0cmFuc2Zvcm1SZXBvIiwiZXZlbnRzIiwidHJhbnNmb3JtRXZlbnQiLCJiaW5kIiwiZmlsdGVyIiwiZXZlbnQiLCJyZXBvIiwibmFtZSIsImRlc2NyaXB0aW9uIiwibGFuZ3VhZ2UiLCJzdGFycyIsInN0YXJnYXplcnNfY291bnQiLCJ1cGRhdGVkX2F0IiwiaHRtbF91cmwiLCJ0eXBlIiwiYWN0aW9uIiwiZm9ybWF0RXZlbnRBY3Rpb24iLCJjb21taXRDb3VudCIsInBheWxvYWQiLCJjb21taXRzIiwibGVuZ3RoIiwicmVmX3R5cGUiLCJyZWYiLCJyZXBsYWNlIiwiZm9ybWF0R2l0aHViU3RhdHNGb3JDb250ZXh0Iiwic3RhdHMiLCJmb3JtYXRCYXNpY0dpdEh1YlN0YXRzIiwiZm9ybWF0UmVwb3NpdG9yaWVzU2VjdGlvbiIsImZvcm1hdEFjdGl2aXR5U2VjdGlvbiIsIkJvb2xlYW4iLCJqb2luIiwiRGF0ZSIsImdldEZ1bGxZZWFyIiwic2xpY2UiLCJmb3JtYXRSZXBvc2l0b3J5IiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwiYWN0aXZpdGllcyIsImFjdGl2aXR5U3RhdHMiLCJjYWxjdWxhdGVBY3Rpdml0eVN0YXRzIiwidG90YWxBY3Rpb25zIiwiYWN0aXZlUmVwb3MiLCJtb3N0UmVjZW50RGF0ZSIsImFjdGl2aXR5VHlwZXMiLCJTZXQiLCJmb3JFYWNoIiwiYWN0aXZpdHkiLCJhY3Rpdml0eVR5cGUiLCJhZGQiLCJyZXBvTmFtZSIsImFjdGl2aXR5RGF0ZSIsInNpemUiLCJBcnJheSIsImZyb20iLCJpbml0aWFsaXplIiwiYWRkTWVzc2FnZVRvSGlzdG9yeSIsInJvbGUiLCJ0aW1lc3RhbXAiLCJwdXNoIiwiZ2V0R2l0aHViQ29udGV4dElmTmVlZGVkIiwiY3JlYXRlRXJyb3JSZXNwb25zZSIsInByb2Nlc3NNZXNzYWdlIiwiZ2VuZXJhdGVBSVJlc3BvbnNlIiwiZXJyb3JSZXNwb25zZSIsImJ1aWxkTWVzc2FnZXNGb3JBSSIsImNhbGxPcGVuQUlBUEkiLCJtZXNzYWdlcyIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm1vZGVsIiwibWF4X3Rva2VucyIsImVycm9yRGF0YSIsImNhdGNoIiwiY2hvaWNlcyIsImNsZWFySGlzdG9yeSIsImdldEhpc3RvcnkiLCJjaGF0Ym90SW5zdGFuY2UiLCJnZXRDaGF0Ym90SW5zdGFuY2UiLCJhc3luYyIsImluaXRpYWxpemVDaGF0Ym90IiwibW9kdWxlIiwiZXhwb3J0cyIsIndpbmRvdyIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImNvbnRhaW5lciIsImdldEVsZW1lbnRCeUlkIiwiY3JlYXRlRWxlbWVudCIsImlkIiwiYXBwZW5kQ2hpbGQiLCJsb2ciLCJDSEFUQk9UX1VJX0NPTkZJRyIsImlzT3BlbiIsInNjcm9sbFRvQm90dG9tIiwibWVzc2FnZXNDb250YWluZXIiLCJxdWVyeVNlbGVjdG9yIiwic2Nyb2xsVG8iLCJ0b3AiLCJzY3JvbGxIZWlnaHQiLCJiZWhhdmlvciIsImFkZE1lc3NhZ2UiLCJzZW5kZXIiLCJpc0Vycm9yIiwibWVzc2FnZUVsZW1lbnQiLCJjbGFzc05hbWUiLCJjbGFzc0xpc3QiLCJmb3JtYXR0ZWRDb250ZW50IiwidG9Mb2NhbGVUaW1lU3RyaW5nIiwiaG91ciIsIm1pbnV0ZSIsImlubmVySFRNTCIsInJlbW92ZVR5cGluZ0luZGljYXRvciIsInR5cGluZ0VsZW1lbnQiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJ0b2dnbGVDaGF0Ym90IiwiY2hhdGJvdFdpbmRvdyIsImNsb3NlQ2hhdGJvdCIsInN0eWxlIiwiZGlzcGxheSIsImlucHV0Iiwic2V0VGltZW91dCIsImZvY3VzIiwic2VuZE1lc3NhZ2UiLCJ0cmltIiwidHlwaW5nSW5kaWNhdG9yIiwic2hvd1R5cGluZ0luZGljYXRvciIsInByb2Nlc3NNZXNzYWdlRm4iLCJzaG93V2VsY29tZU1lc3NhZ2UiLCJjbGVhckNoYXQiLCJjbGVhckhpc3RvcnlGbiIsImNyZWF0ZUNoYXRib3RDb250YWluZXIiLCJ0b2dnbGUiLCJjbG9zZUJ0biIsImZvcm0iLCJlIiwicHJldmVudERlZmF1bHQiLCJrZXkiLCJzaGlmdEtleSIsImRpc3BhdGNoRXZlbnQiLCJFdmVudCIsImF0dGFjaEV2ZW50TGlzdGVuZXJzIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIm4iLCJnZXR0ZXIiLCJfX2VzTW9kdWxlIiwiZCIsImEiLCJkZWZpbml0aW9uIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiXSwic291cmNlUm9vdCI6IiJ9